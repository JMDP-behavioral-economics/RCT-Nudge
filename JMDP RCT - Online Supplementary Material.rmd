---
title: |
  Supplementary Material
  "Exploring Information Provision to Promote Stem Cell Donation: Evidence from a Field Experiment of the Japan Marrow Donor Program"
author:
  - name: Hiroki Kato
    affil-id: a
  - name: Fumio Ohtake
    affil-id: b
  - name: Saiko Kurosawa
    affil-id: c
  - name: Kazuhiro Yoshiuchi
    affil-id: d
  - name: Takahiro Fukuda
    affil-id: e
affiliations:
  - id: a
    name: School of International Politics, Economics and Communication, Aoyama Gakuin University, Tokyo, Japan
  - id: b
    name: Center for Infectious Disease Education and Research (CiDER), Osaka University, Osaka, Japan
  - id: c
    name: Department of Oncology, Ina Central Hospital, Nagano, Japan
  - id: d
    name: Graduate School of Medicine, The University of Tokyo, Tokyo, Japan
  - id: e
    name: Department of Hematopoietic Stem Cell Transplantation, National Cancer Center Hospital, Tokyo, Japan
bibliography: biblio.bib
biblio-style: agsm
output:
  bookdown::pdf_document2:
    latex_engine: pdflatex
    template: template/my-template-science-direct.tex
    keep_tex: true
    toc: false
    number_sections: true
    citation_package: natbib
base-strech: 1.5
fontsize: 12pt
---

```{r include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  error = FALSE,
  message = FALSE,
  dev = "pdf",
  fig.width = 15,
  fig.height = 10,
  fig.pos = "H",
  out.extra = ""
)
```

\tableofcontents

\appendix

\setcounter{figure}{0}
\setcounter{table}{0}
\renewcommand\thefigure{\thesection\arabic{figure}}
\renewcommand{\thetable}{\thesection\arabic{table}}
\renewcommand{\theHfigure}{\thesection\arabic{figure}}
\renewcommand{\theHtable}{\thesection\arabic{table}}

# Figures and Tables {#figtab}

```{r library, include=FALSE}
library(here)
library(xfun)
source(here("R/R6_RawData.r"))
source(here("R/R6_Schedule.r"))

options(
  knitr.table.format = "latex",
  knitr.kable.NA = "",
  kableExtra.auto_format = FALSE,
  modelsummary_factory_latex = "kableExtra",
  modelsummary_get = "broom",
  modelsummary_stars_note = FALSE
)
```

```{r data, include=FALSE}
data_root <- "data"

rawdt <- RawData$new(
  here(data_root, "shape.csv"),
  treat_vars = "treat",
  treat_levels = LETTERS[1:4],
  treat_labels = c("StatusQuo", "MatchMessage", "CoordMessage", "BothMessage")
)

# main sample
rawdt$add_cond_study_sample("ongoing == 0")

# robust sample (remove those who skipped the CT)
rawdt_noskip <- rawdt$clone()
rawdt_noskip$add_cond_study_sample("reply == 0 | days_reply > 0")
```

```{r set-rct-class, include=FALSE}
intervention <- list(
  "Standard message" = c(StatusQuo = "X", MatchMessage = "X", CoordMessage = "X", BothMessage = "X"),
  "\\revise{Matching difficulty} message" = c(StatusQuo = "", MatchMessage = "X", CoordMessage = "", BothMessage = "X"),
  "Early coordination message" = c(StatusQuo = "", MatchMessage = "", CoordMessage = "X", BothMessage = "X")
)

endpoint <- list(
  reply = "Response",
  positive = "Positive intention",
  test = "CT",
  candidate = "Donor selection",
  consent = "Final consent",
  donate = "Donation"
)

# main sample
rct <- rawdt$RCT()
rct$add_intervention(intervention)
rct$add_outcome(endpoint)
rct$set_default_cluster("RCTweek")
rct$set_default_se_type("stata")

# robust sample (remove those who skipped the CT)
rct_noskip <- rawdt_noskip$RCT()
rct_noskip$add_intervention(intervention)
rct_noskip$add_outcome(endpoint)
rct_noskip$set_default_cluster("RCTweek")
rct_noskip$set_default_se_type("stata")
```

```{r smd-balance}
rct$
  smd_balance()$
  kable(
    title = "Assessing Balance by Standardized Mean Difference",
    notes = "\\\\emph{Note}: These values represent the standardized mean differences (SMD) with the control arm (experimental group A). Generally, covariates between two groups are balanced if the SMD is less than $0.1$.",
    hold = TRUE,
    font_size = 8
  )
```

```{r lm-skip}
skip_dt <- rct$data %>%
  mutate(
    coordinate_more = if_else(coordinate1 == 0, 100, 0),
    skip_test = skip_test * 100
  )

ctrl_avg <- skip_dt %>%
  filter(treat == "StatusQuo") %>%
  summarize_at(vars(coordinate_more, skip_test), list(~ mean(.))) %>%
  mutate_all(list(~ sprintf("%1.2f", .)))

add_tab <- data.frame(rbind(
  c(
    "Control average",
    ctrl_avg$coordinate_more, ctrl_avg$coordinate_more, ctrl_avg$coordinate_more,
    ctrl_avg$skip_test, ctrl_avg$skip_test, ctrl_avg$skip_test
  ),
  c(
    "Covariates",
    "", "X", "X",
    "", "X", "X"
  ),
  c(
    "Month FE",
    "", "", "X",
    "", "", "X"
  )
))

attr(add_tab, "position") <- 7:9

skip_mods <- list(
  coordinate_more ~ treat,
  coordinate_more ~ treat + male + age + I(age^2) + hospital_per_area +
    PB_per_area + BM_per_area + holidays,
  coordinate_more ~ treat + male + age + I(age^2) + hospital_per_area +
    PB_per_area + BM_per_area + holidays + factor(month),
  skip_test ~ treat,
  skip_test ~ treat + male + age + I(age^2) + coordinate + hospital_per_area +
    PB_per_area + BM_per_area + holidays,
  skip_test ~ treat + male + age + I(age^2) + coordinate + hospital_per_area +
    PB_per_area + BM_per_area + holidays + factor(month)
)

est_skip_mods <- skip_mods %>%
  purrr::map(~ lm_robust(., data = skip_dt, se_type = "stata", clusters = RCTweek))

est_skip_mods %>%
  modelsummary(
    title = "Linear Probability Model of Number of Coordination and Skipping CT",
    coef_map = c(
      "treatMatchMessage" = "MatchMessage group",
      "treatCoordMessage" = "CoordMessage group",
      "treatBothMessage" = "BothMessage group"
    ),
    gof_omit = "R2|AIC|BIC|Log|Std|FE|se_type|RMSE",
    align = "lcccccc",
    stars = c("***" = .01, "**" = .05, "*" = .1),
    add_rows = add_tab,
    fmt = 2
  ) %>%
  kableExtra::kable_styling(
    font_size = 8,
    latex_options = "HOLD_position"
  ) %>%
  kableExtra::add_header_above(
    c(" " = 1, "\\\\# Coordination $>$ 1" = 3, "Skipped CT" = 3),
    escape = FALSE
  ) %>%
  kableExtra::footnote(
    general_title = "",
    general = "\\\\emph{Note}: * $p < 0.1$, ** $p < 0.05$, *** $p < 0.01$. Standard errors clustered by the assigned week are in parentheses. The unit of treatment effect is a percentage point. Covariates are gender, age, its squared term, the number of past coordinations, the number of public holidays in the assigned week and the following week, the number of hospitals per 10 square kilometers, the number of hospitals with PBSC collection per 10 square kilometers and the number of hospitals with BM collection per 10 square kilometers. All covariates were demeaned. We excluded the number of past coordinations in model (2).",
    threeparttable = TRUE,
    escape = FALSE
  )
```

```{r cross-table-skip}
skip_dt %>%
  mutate(
    `Coordination experience` = if_else(
      coordinate_more == 0, "First-time coordination", "Second-time or more coordination"
    ),
    skip_test = if_else(skip_test == 0, "Not skipped", "Skipped")
  ) %>%
  datasummary_crosstab(
    `Coordination experience` ~ skip_test,
    data = .,
    title = "Cross-Table of Coordination Experience and Skipping CT",
    fmt = 2
  ) %>%
  kableExtra::kable_styling(font_size = 8, latex_options = "HOLD_position")
```

```{r lm-test}
res <- rct$
  lm_effect("test", sample_drop = FALSE)$
  fit(scale = 100)$
  get_est()

mha_test <- cache_rds(
  {
    rct$
      multiple_hypotheses_adjust("test")$
      estimate(scale = 100, B = 3000)$
      get_result()
  },
  file = "mh-adjust-test.rds"
)

mha_test_tab <- data.frame(mha_test) %>%
  select(term = Treated.id, "(1)" = List.p) %>%
  mutate(
    term = paste(term, "group", "(adjusted p-value)"),
    "(1)" = sprintf("%1.3f", `(1)`),
    "(2)" = "",
    "(3)" = ""
  )

add_tab <- data.frame(
  rbind(
    mha_test_tab,
    c("Control average", sprintf("%1.2f", res$avg)),
    c("Covariates", res$covariate),
    c("Month FE", res$fe)
  )
)

attr(add_tab, "position") <- 7:12

res %>%
  pull(fit) %>%
  modelsummary(
    title = "Linear Probability Model of CT",
    coef_map = c(
      "treatMatchMessage" = "MatchMessage group",
      "treatCoordMessage" = "CoordMessage group",
      "treatBothMessage" = "BothMessage group"
    ),
    stars = c("***" = .01, "**" = .05, "*" = .1),
    gof_omit = "R2|AIC|BIC|Log|Std|FE|se_type|RMSE",
    align = "lccc",
    add_rows = add_tab,
    fmt = 2,
    escape = FALSE
  ) %>%
  kableExtra::kable_styling(font_size = 8, latex_options = "HOLD_position") %>%
  kableExtra::add_header_above(c(" " = 1, "CT" = 3)) %>%
  kableExtra::group_rows(
    "Adjustment of p-values for multiple hypotheses testing",
    7, 9,
    bold = FALSE, italic = TRUE
  ) %>%
  kableExtra::column_spec(1, width = "20em") %>%
  kableExtra::footnote(
    general_title = "",
    general = "\\\\emph{Note}: * $p < 0.1$, ** $p < 0.05$, *** $p < 0.01$. Standard errors clustered by the assigned week are in parentheses. The unit of treatment effect is a percentage point. Covariates are sex, age, its squared term, the number of past coordinations, the number of public holidays in the assigned week and following week, the number of hospitals per 10 square kilometers, the number of hospitals with PBSC collection per 10 square kilometers, the number of hospitals with bone marrow collection per 10 square kilometers, and a dummy indicating that a candidate can skip CT. All the covariates except the sex dummy and dummy of skipped CT were demeaned. We employed the method proposed by \\\\citet{List2019} to adjust the p-values for multiple testing. We used bootstrapping with 3,000 bootstrap samples to calculate the adjusted p-values.",
    threeparttable = TRUE,
    escape = FALSE
  )
```

```{r logit-test}
rct$
  logit_effect("test", sample_drop = FALSE)$
  fit()$
  kable(
    title = "Logit Model of the CT",
    notes = "Standard errors clustered by the assigned week are in parentheses. Covariates are gender, age, its squared term, the number of past coordinations, the number of public holidays in the assigned week and the following week, the number of hospitals per 10 square kilometers, the number of hospitals with PBSC collection per 10 square kilometers and the number of hospitals with BM collection per 10 square kilometers. All covariates except gender dummy and dummy of skipped CT were demeaned.",
    fmt = "%.2f",
    hold = TRUE,
    font_size = 8
  ) %>%
  column_spec(1, width = "20em")
```

```{r speed-CT-cond-response, fig.cap = "Binned Scatter Plot of CT vs. Response Speed among Those Who Responded with Positive Intention. \\newline \\emph{Note}: We used those who responded with positive intention to donate in the control group (StatusQuo group). The dashed line represents nonparametric fitting. The solid line represents a fitted line of the logistic regression.", fig.pos = "H"}
positive_dt <- rct$data %>%
  filter(positive == 1 & 0 < days_reply & treat == "StatusQuo")

plotdt <- positive_dt %>%
  mutate(ntile = ntile(days_reply, 20)) %>%
  group_by(ntile) %>%
  summarize(
    median_day = (max(days_reply) + min(days_reply)) / 2,
    mean_ct = mean(test)
  )

plotdt %>%
  ggplot(aes(x = median_day, y = mean_ct)) +
    geom_point(color = "grey40", size = 3) +
    geom_smooth(
      aes(x = days_reply, y = test),
      data = positive_dt,
      method = "glm",
      method.args = list(family = "binomial"),
      se = FALSE,
      alpha = 0.2,
      color = "black",
      linetype = 1
    ) +
    geom_smooth(
      aes(x = days_reply, y = test),
      data = positive_dt,
      se = FALSE,
      alpha = 0.2,
      color = "black",
      linetype = 2
    ) +
    labs(x = "Response days", y = "Proportion of Reaching CT", shape = "Outcome") +
    my_theme_classic(size = 25)
```

```{r coordinate-diff-mean, fig.height=10, fig.cap = "Sample Averages of Donor Selection, Final Consent, and Donation by Experimental Groups.\\newline \\emph{Note}: Error bars show standard errors of the mean. For the statistical test, we used standard errors clustered by the assigned week."}
rct$
  lm_effect(c("candidate", "consent", "donate"), sample_drop = FALSE)$
  fit(scale = 100)$
  plot_ate(
    xlab = "Experimental group",
    ylab = "Share of participants (%)",
    p_text_margin = 4,
    add_segment_margin = 12,
    segment_margin = 5,
    show_p = 1,
    edge_length = 2,
    p_text_size = 7,
    avg_text_pos = 2,
    avg_digit = 1,
    avg_text_size = 7,
    ylim = c(0, 100),
    ybreaks = seq(0, 100, by = 10),
    base_size = 25
  ) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)
  )
```

```{r lm-coordinate}
rct$
  lm_effect(c("candidate", "consent", "donate"), sample_drop = FALSE)$
  fit(scale = 100)$
  kable_reg(
    title = "Linear Probability Model of the Coordination Processes After CT",
    coef_map_lm = c(
      "treatMatchMessage" = "MatchMessage group",
      "treatCoordMessage" = "CoordMessage group",
      "treatBothMessage" = "BothMessage group"
    ),
    notes = "Standard errors clustered by the assigned week are in parentheses. The unit of treatment effect is a percentage point. Covariates are sex, (demeaned) age, its squared term, the number of past coordinations, the number of public holidays in the assigned week and following week, the number of hospitals per 10 square kilometers, the number of hospitals with PBSC collection per 10 square kilometers, and the number of hospitals with bone marrow collection per 10 square kilometers. All the covariates except sex were demeaned.",
    font_size = 8,
    hold = TRUE
  )
```

\clearpage

```{r logit-coordinate}
rct$
  logit_effect(c("candidate", "consent", "donate"), sample_drop = FALSE)$
  fit()$
  kable(
    title = "Logit Model of Coordination Process After CT",
    notes = "Standard errors clustered by the assigned week are in parentheses. Covariates are gender, age, its squared term, the number of past coordinations, the number of public holidays in the assigned week and the following week, the number of hospitals per 10 square kilometers, the number of hospitals with PBSC collection per 10 square kilometers and the number of hospitals with BM collection per 10 square kilometers. All covariates except gender dummy and dummy of skipped CT were demeaned.",
    fmt = "%.2f",
    hold = TRUE,
    font_size = 8
  ) %>%
  landscape()
```

```{r lm-decompose-effect-donor-selection}
test_dt <- rct$data %>%
  filter(test == 1) %>%
  mutate(
    age = age - mean(age),
    holidays = holidays - mean(holidays),
    PB_per_area = PB_per_area - mean(PB_per_area),
    BM_per_area = BM_per_area - mean(BM_per_area),
    hospital_per_area = hospital_per_area - mean(hospital_per_area),
    days_reply = days_reply - mean(days_reply)
  )

models <- list(
  I(candidate * 100) ~ treat,
  I(candidate * 100) ~ treat + male + age + I(age^2) + coordinate + skip_test +
    holidays + PB_per_area + BM_per_area + hospital_per_area,
  I(candidate * 100) ~ treat + male + age + I(age^2) + coordinate + skip_test +
    holidays + PB_per_area + BM_per_area + hospital_per_area + factor(month),
  I(exg_stop_candidate * 100) ~ treat,
  I(exg_stop_candidate * 100) ~ treat + male + age + I(age^2) + coordinate + skip_test +
    holidays + PB_per_area + BM_per_area + hospital_per_area,
  I(exg_stop_candidate * 100) ~ treat + male + age + I(age^2) + coordinate + skip_test +
    holidays + PB_per_area + BM_per_area + hospital_per_area + factor(month),
  I((candidate == 0 & exg_stop_candidate == 0) * 100) ~ treat,
  I((candidate == 0 & exg_stop_candidate == 0) * 100) ~ treat + male + age + I(age^2) + coordinate + skip_test +
    holidays + PB_per_area + BM_per_area + hospital_per_area,
  I((candidate == 0 & exg_stop_candidate == 0) * 100) ~ treat + male + age + I(age^2) + coordinate + skip_test +
    holidays + PB_per_area + BM_per_area + hospital_per_area + factor(month)
)

fit_models <- models %>%
  map(~ lm_robust(., data = test_dt, se_type = "stata", clusters = RCTweek))

add_table <- data.frame(rbind(
  c("Covariates", rep(c("", "X", "X"), 3)),
  c("Month FE", rep(c("", "", "X"), 3))
))

attr(add_table, "position") <- 7:8

fit_models %>%
  modelsummary(
    title = "Effect on Donor Selection and Dropout among Potential Donors Reaching CT",
    coef_map = c(
      "treatMatchMessage" = "MatchMessage group",
      "treatCoordMessage" = "CoordMessage group",
      "treatBothMessage" = "BothMessage group"
    ),
    gof_omit = "AIC|BIC|RMSE|Std.Errors",
    stars = c("***" = 0.01, "**" = 0.05, "*" = 0.1),
    escape = FALSE,
    output = "kableExtra",
    fmt = 2,
    add_rows = add_table
  ) %>%
  kableExtra::kable_styling(font_size = 8, latex_options = "HOLD_position") %>%
  kableExtra::add_header_above(c(" " = 1, "Donor selection" = 3, "Exogenous dropout" = 3, "Endogenous dropout" = 3)) %>%
  kableExtra::footnote(
    general_title = "",
    general = "\\\\emph{Note}: * $p < 0.1$, ** $p < 0.05$, *** $p < 0.01$. The standard errors clustered by the assigned week are in parentheses. The unit of treatment effect is a percentage point. The outcome ``Exogenous dropout'' is a dummy variable that takes a value of 1 if coordination was interrupted due to exogenous reasons (reasons related with donor health and patient) between CT and donor selection. The outcome ``Endogenous dropout'' is a dummy variable that takes a value of 1 if coordination was interrupted due to endogenous reasons (donor reasons other than health) between CT and donor selection. Covariates are gender, age, its squared term, the number of past coordinations, the number of public holidays in the assigned week and the following week, the number of hospitals per 10 square kilometers, the number of hospitals with PBSC collection per 10 square kilometers, the number of hospitals with BM collection per 10 square kilometers, and a dummy indicating that candidate can have skipped the CT. All covariates except gender dummy and dummy of skipped CT were demeaned.",
    threeparttable = TRUE,
    escape = FALSE
  )
```


```{r lm-who-selected-statusquo}
test_dt <- rct$data %>%
  filter(test == 1) %>%
  mutate(
    age = age - mean(age),
    holidays = holidays - mean(holidays),
    PB_per_area = PB_per_area - mean(PB_per_area),
    BM_per_area = BM_per_area - mean(BM_per_area),
    hospital_per_area = hospital_per_area - mean(hospital_per_area),
    days_reply = days_reply - mean(days_reply)
  )

mods <- list(
  I(candidate * 100) ~ male + age + coordinate1 + skip_test + days_reply +
    holidays + PB_per_area + BM_per_area + hospital_per_area,
  I(donate * 100) ~ male + age + coordinate1 + skip_test + days_reply +
    holidays + PB_per_area + BM_per_area + hospital_per_area
)

fit_mods <- mods %>%
  map(~ lm_robust(
    .,
    data = subset(test_dt, treat == "StatusQuo"),
    se_type = "stata",
    clusters = RCTweek
  ))

fit_mods %>%
  modelsummary(
    title = "Determination of Donor Selection and Donation among Potential Donors Reaching CT (only Status Quo Group)",
    coef_map = c(
      "(Intercept)" = "(Intercept)",
      "male" = "Male",
      "age" = "Age (demeaned)",
      "coordinate1" = "First-time coordination",
      "skip_test" = "Skipped CT",
      "days_reply" = "Response days (demeaned)",
      "holidays" = "\\# holidays (demeaned)",
      "hospital_per_area" = "\\# hospitals (demeaned)",
      "PB_per_area" = "\\# hospitals with PBSC collection (demeaned)",
      "BM_per_area" = "\\# hospitals with BM collection (demeaned)",
      "male:age" = "Male $\\times$ Age",
      "male:coordinate1" = "Male $\\times$ First-time coordination",
      "age:coordinate1" = "Age $\\times$ First-time coordination",
      "male:age:coordinate1" = "Male $\\times$ Age $\\times$ First-time coordination",
      "male:skip_test" = "Male $\\times$ Skipped CT",
      "age:skip_test" = "Age $\\times$ Skipped CT",
      "male:age:skip_test" = "Male $\\times$ Age $\\times$ Skipped CT"
    ),
    gof_omit = "AIC|BIC|RMSE|Std.Errors",
    stars = c("***" = 0.01, "**" = 0.05, "*" = 0.1),
    escape = FALSE,
    fmt = 2
  ) %>%
  kableExtra::kable_styling(font_size = 8, latex_options = "HOLD_position") %>%
  kableExtra::add_header_above(c(" " = 1, "Donor selection" = 1, "Donation" = 1)) %>%
  kableExtra::footnote(
    general_title = "",
    general = "\\\\emph{Note}: * $p < 0.1$, ** $p < 0.05$, *** $p < 0.01$. We estimated the linear probability model. The standard errors clustered by the assigned week are in parentheses. The unit of coefficients is a percentage point. We used potential donors who completed the CT in the control group. The number of holidays is the sum of the number of holidays in the assigned week and the following week. The number of listed hospitals is per 10 square kilometers. Reseponse days are days that passed between the date of receiving the HLA match letter and the date of responding to the letter. We demeaned covariates except male dummy, dummy of first-time coordination, and dummy of skipped CT.",
    threeparttable = TRUE,
    escape = FALSE
  )
```


```{r lm-interaction-gender-coordination-age, fig.width = 15, fig.height = 15, fig.cap = "Heterogeneous Treatment Effects on CT, Donor Selection, and Donation by Sex, Age, and CoordinationExperience Groups. \\newline \\emph{Note}: The standard errors clustered by the assigned week are in parentheses. Covariates are the number of public holidays in the assigned week and the following week, the number of hospitals per 10 square kilometers, the number of hospitals with PBSC collection per 10 square kilometers and the number of hospitals with BM collection per 10 square kilometers. All covariates were demeaned. We also controlled cross terms of each covariate and group dummies.", fig.pos = "H"}
rct3 <- rct$clone()

rct3$data <- rct3$data %>%
  mutate(
    young = if_else(age <= 39, 1, 0),
    group = case_when(
      male == 1 & coordinate1 == 1 & young == 1 ~ "Flesh male (20--39)",
      male == 1 & coordinate1 == 1 & young == 0 ~ "Flesh male (39--54)",
      male == 1 & coordinate1 == 0 & young == 1 ~ "Experienced male (20--39)",
      male == 1 & coordinate1 == 0 & young == 0 ~ "Experienced male (39--54)",
      male == 0 & coordinate1 == 1 & young == 1 ~ "Flesh female (20--39)",
      male == 0 & coordinate1 == 1 & young == 0 ~ "Flesh female (39--54)",
      male == 0 & coordinate1 == 0 & young == 1 ~ "Experienced female (20--39)",
      male == 0 & coordinate1 == 0 & young == 0 ~ "Experienced female (39--54)",
    )
  )

est_hetero3 <- rct3$
  lm_effect(c("test", "candidate", "donate"), sample_drop = FALSE)$
  fit(scale = 100, interaction = "group", drop_x = c("male", "coordinate", "skip_test", "age"))$
  get_est()

coef_dt <- est_hetero3 %>%
  filter(model == 2) %>%
  select(outcome, fit) %>%
  mutate(
    coef = map(fit, function(x) {
      single <- tidy(x$lm_robust) %>%
        filter(term %in% c("treatMatchMessage", "treatCoordMessage", "treatBothMessage"))

      combine <- bind_rows(single, x$lh) %>%
        select(-outcome)

      return(combine)
    })
  ) %>%
  select(-fit) %>%
  unnest(coef) %>%
  mutate(
    treat = case_when(
      str_detect(term, "treatMatchMessage") ~ "MatchMessage",
      str_detect(term, "treatCoordMessage") ~ "CoordMessage",
      str_detect(term, "treatBothMessage") ~ "BothMessage"
    ),
    age = case_when(
      !str_detect(term, "\\+") ~ "20--39",
      str_detect(term, "\\(20--39\\)") ~ "20--39",
      str_detect(term, "\\(39--54\\)") ~ "39+"
    ),
    group = case_when(
      !str_detect(term, "\\+") ~ "Experienced female",
      str_detect(term, "Experienced female") ~ "Experienced female",
      str_detect(term, "Flesh female") ~ "Flesh female",
      str_detect(term, "Experienced male") ~ "Experienced male",
      str_detect(term, "Flesh male") ~ "Flesh male"
    ),
    outcome = factor(outcome, levels = c("CT", "Donor selection", "Donation")),
    treat = factor(treat, levels = c("MatchMessage", "CoordMessage", "BothMessage")),
    age = factor(age, levels = c("20--39", "39+")),
    group = factor(group, levels = c("Flesh male", "Flesh female", "Experienced male", "Experienced female"))
  )

coef_dt %>%
  ggplot(aes(x = age, y = estimate, shape = group, color = group)) +
    geom_hline(yintercept = 0, linetype = "dashed") +
    geom_point(size = 3, position = position_dodge(width = 0.5)) +
    geom_errorbar(
      aes(ymin = conf.low, ymax = conf.high),
      position = position_dodge(width = 0.5),
      width = 0.2
    ) +
    facet_grid(treat ~ outcome) +
    theme_minimal(base_size = 20) +
    scale_shape_manual(values = c(1, 2, 0, 5)) +
    labs(
      x = "Age group",
      y = "Treatment effect (percentage points; 95%CI)",
      shape = "Sex-Experience Group",
      color = "Sex-Experience Group"
    ) +
    theme(
      legend.position = "bottom",
      axis.text.x = element_text(angle = 45, hjust = 1)
    )
```


<!---
# Economic Models for Predictions

In this section, we present a simple inter-temporal economic model to make predicitions of message effects. We assume that the matched donor may have the present bias, which is one of the most important insight from behaviorl economics [@Laibson1997; @ODonoghue2001].

\noindent
**Events.** Consider three periods ($t = 1, 2, 3$). At $t=1$, a matched donor receives the compatibility notice, which asks him/her to donate. The matched donor has three options: quick response (responsding at $t=1$); late response (responding at $t=2$); no response. If the matched donor responds, then the donor pays coordination cost $c$ at that time and obtains net-benefit of transplantion at the next period. The net-benefit of transplantion may be time-variant: $b_t$ if the matched donor responds at period $t$. We assume $b_1 \ge b_2$. If the matched donor does not respond, the donor does not pay any cost and receive any net-benefit.

\noindent
**Preference.** According to @Laibson1997, the utility function is $U_t = u_t + \beta \sum_{\tau = t + 1}^{3} \delta^{\tau - t} u_{\tau}$ where $\beta \in (0, 1]$ is the degree of present bias and $\delta \in (0, 1]$ is standard time discount factor. Moreover, at period $t$, the donor expect that s/he makes decisions after $t + 1$ based on $\hat{\beta} \in [\beta, 1]$. If $\beta < \hat{\beta}$, the donor falsely believes that the present bias of their future self is not as strong.

We will solve an interpersonal game [@ODonoghue2001] to obtain optimal response timing. The first result shows that the matched donor thinks that the late response is never optimal regardless of the present bias before receiving the compatibility notice ($t=0$).

\noindent
**Result 1.** For any $\beta$, $\hat{\beta}$ and $b_2$, at $t = 0$, the quick response is optimal if $b_1 \ge c/\delta$; otherwise the no response is optimal.

\noindent
*Proof.* At $t=0$, the utility of the quick response is $\beta(-\delta c + \delta^2 b_1)$, which is positive $b_1 > c / \delta$. The utility of the late response is $\beta(-\delta^2 c + \delta^3 b_2)$. Let $b_2 = b_1 - d$ for $d \ge 0$. Then, the utility of the late response is positive if $b_1 > c/\delta + d$. Note that the utility of the no response is zero. Thus, if $b_1 < c/\delta$, then the no response is optimal because the quick response and the late response produce negative utilities. The quick response is preferred to the late response if
\begin{equation}
  b_1 \ge \frac{c}{\delta} - \frac{\delta}{1-\delta}d. (\#eq:cond-t0)
\end{equation}
Thus, the quick response is optimal if $b_1 \ge c/\delta$ since the Equation (\ref{eq:cond-t0}) holds.

This resuls implies that, before receiving the compatibility notice, the matched donor thinks that the donor quickly respond to the compatibility notice if the transplantion net-benefit is sufficiently large. The next result presents that the donor may delay the response, while receiving the notice, even if the trasplantation value is sufficiently large.

\noindent
**Result 2.** Suppose that $b_1 = b_2$. At $t=1$, the quick response is optimal if $b_1 \ge c \frac{1-\beta\delta}{(1-\delta)\beta\delta}$; the late response is optimal if $c \frac{1-\beta\delta}{(1-\delta)\beta\delta} > b_1 \ge c/\beta\delta$; otherwise the no response is optimal.

\noindent
*Proof.* We employ the backward-induction to solve the interpersonal game. Consider $t=2$. If the matched donor does not choose the quick response, the donor can respond to the notice at that period. Then, the utility of the late response at $t=2$ is $-c + \beta\delta b_2$. Thus, the late response is optimal iff $b_2 \ge c/\beta\delta$. Otherwise, the donor choose the no response. Next, we go back to $t=1$ and analyze how the donor expects behavior at $t=2$. The donor believes that future selve's present bias is $\hat{\beta}$. Thus, at $t = 1$, the donor expect that s/he will respond at $t = 2$ (the late response) if and only if $b_2 \ge c/\hat{\beta}\delta$. Assuming $b_2 = b_1$, we derive the optimal choice at $t=1$ in three cases.

- Consider $b_1 < c/\hat{\beta}\delta$. Then, at $t = 1$, the donor expects to give up responding, and actually does so. Thus, the donor at $t = 1$ responds if and only if $U_1 = -c + \beta\delta b_1 \ge 0$ or $b_1 \ge c/\beta\delta$. Otherwise, the donor gives up responding. Thus, the optimal choice is the no response.
- Consider $c/\hat{\beta}\delta \le b_1 < c/\beta\delta$. Then, at $t=1$, the donor expects to respond at $t = 2$, but will not actually take that action (no response). Due to this false prediction, the donor at $t = 1$ responds if and only if $U_1 \ge \beta(-\delta c + \delta^2 b_1)$ or
\begin{equation}
  c \frac{1 - \beta\delta}{(1-\delta)\beta\delta} \le b_1. (\#eq:cond-t1)
\end{equation}
Otherwise, the donor eventually stops responding. Since $\frac{1}{\beta\delta} < \frac{1 - \beta\delta}{\beta\delta}$, the optimal choice is the no response in this case.
- Consider $c/\beta\delta \le b_1$. Then, at $t = 1$, the donor expects to respond at $t = 2$, and actually does so. Thus, the donor responds at $t = 1$ if and only if equation (\ref{eq:cond-t1}) holds. Otherwise, the donor responds at $t=2$.

This result is motivated us to create the Early Coordination message. If the net benefit of transplantion is time-invariant, then some mathced donors thinks that the quick response is ideal but acutually choose the late response or the no response. Especially, if $c/\delta \le b_1 < c/\beta\delta$, then the matched donor thinks that the quick response but does not actually respond to the compatibility notice. If $c/\beta\delta \le b_1 < c \frac{1 - \beta\delta}{(1-\delta)\beta\delta}$, then the matched donor thinks that the quick response but does delay response to the compatibility notice.

The next result shows that almost matched donor follows ideal behavior (the optimal choice at $t=0$; see Result 1) if there is sufficiently large difference between $b_1$ and $b_2$

\noindent
**Result 3.** Let $b_2 = b_1 - d$. Suppose that $c \left(\frac{1-\beta\delta}{\beta\delta} - \frac{1-\delta}{\hat{\beta}\delta} \right) < d$. Then, the matched donor actually chooses the quick response if $c/\beta\delta \le b_1$; otherwise the matched donor actually chooses the no response.
--->