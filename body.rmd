---
title: |
  Only You:
  A Field Experiment of Text Message to Prevent Free-riding in Japan Marrow Donor Program
abstract: |
  日本骨髄バンクを介した同種造血幹細胞移植は移植に至るまで長時間を要し、登録患者の約半数しか移植を受けられない。これは移植コーディネーションの多くは登録ドナーが提供に消極的であることによって移植実施前に中断してしまうからである。本研究は日本骨髄バンクの協力のもと、登録ドナーの提供意向を高めるような情報を提供する介入をフィールド実験にて検証する。我々は11,049名の適合ドナーのコーディネーションデータを用いて、情報提供の効果を推定した。我々は患者一人あたりにマッチする潜在ドナーの数が少ないという情報が20代男性の提供意向を25%高めることを明らかにした。また、早いコーディネーションが患者の移植率を高めるという情報が20代女性の早期返信を促していることも明らかにした。これらの結果は情報提供が特定の性・年代にのみ影響を与えており、特に、移植成績の良い若年ドナーの行動変容を促していることを示唆している。
author:
  - Hiroki Kato (Hitostubashi Institute for Advanced Study, Hitotsubashi University, Tokyo, Japan)
  - Fumio Ohtake (Center for Infectious Disease Education and Research (CiDER), Osaka University, Osaka, Japan)
  - Saiko Kurosawa (Department of Oncology, Ina Central Hospital, Nagano, Japan)
  - Kazuhiro Yoshiuchi (Graduate School of Medicine, Tokyo University, Tokyo, Japan)
  - Takahiro Fukuda (Department of Hematopoietic Stem Cell Transplantation, National Cancer Center Hospital, Tokyo, Japan)
date: "Last updated on `r format(Sys.Date(), '%B %d, %Y')`"
bibliography: biblio.bib
output:
  bookdown::word_document2:
    numnber-sections: true
    toc: false
params:
  is_fe: TRUE
  is_cluster: FALSE
  se_type: stata
---

```{r include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  error = FALSE,
  message = FALSE,
  dev = "ragg_png",
  fig.width = 15,
  fig.height = 10
)
```

# Introduction {#intro}

Allogeneic hematopoietic stem cell transplantation is one of the treatments with the lowest relapse rate for leukemia and other blood diseases. In this treatment, (1) anti-cancer drugs and radiation simultaneously kill tumor cells and healthy hematopoietic stem cells, and (2) healthy hematopoietic stem cells donated by others are transplanted. Transplantation requires that the donor's white blood cell type, called HLA, match the patient's HLA.[^hapro] While the probability of a match between two randomly selected individuals is less than 1%, the probability of a match between siblings is the highest at approximately 30%. The probability of a match between parents and children is also quite low. If there is no match among relatives, patients must seek a donor outside the immediate family. In Japan, patients usually seek a non-relative donor through the Japan Marrow Donor Program (JMDP). However, coordination through the JMDP takes a long time, and only 60% of registered patients receive a transplant [@Hirakawa2018]. Therefore, it is important to shorten the time to transplantation and increase the transplantation rate of registered patients.

[^hapro]: The main options for allogeneic hematopoietic stem cell transplantation are bone marrow transplantation, peripheral blood stem cell transplantation, and cord blood transplantation. Bone marrow and peripheral blood stem cell transplantation uses hematopoietic stem cells from the donor's bone marrow and requires an HLA match. In contrast, cord blood transplantation uses blood cells from the umbilical cord and placenta that connect mother and child. This transplanation can be done even if the HLA is not a perfect match. This study will focus on bone marrow and peripheral blood stem cell transplantation. In addition, transplantation between close relatives with semi-matched HLA, known as HLA haploidentical transplantation, has become more widespread in recent years.

There are two types of donor pool policies that increase transplantation rates. The first are policies that increase the number of potential donors to increase the probability of a match. Compared to patients matched with fewer than four donors, the transplantation rate increases from 45% to 74% for patients matched with more than 200 donors [@Hirakawa2018]. However, according to @Takanashi2016, the number of potential donors nearly doubled from 2000 to 2015, but the probability of a first-time match increased by only about 5%. This is because the probability of a new donor with a rare HLA type is low. The marginal benefit of increasing the number of potential donors is small.

The second intervention increases the proportion of potential donors willing to donate and improves the quality of the donor pool. Hirakawa2018 found that many coordinations (73% of those conducted in 2004-2013) were interrupted before the first process of coordination, confirmatory typing, for donor-related reasons (including poor health). In particular, younger donors were less likely to discontinue for health reasons and more likely to discontinue for other donor-related reasons.[^detail-result] This is an issue not only in the JMDP, but also in marrow donor programs in other countries [@Haylock2022]. If donor reasons other than health are correlated with own intentions, then increasing the number of potential donors with strong donor intentions would increase transplantation rates, and the marginal benefit would be greater than the marginal benefit of increasing the number of potential donors.

[^detail_result]: 15% of male coordinations in their 20s were interrupted due to donor infirmity (history, back pain, undergoing treatment, etc.) while 41% were interrupted for donor reasons other than infirmity (uncontactable, unavailability, etc.). Transplantation requires the consent of the donor's family. Donor reasons other than infirmity do not include lack of family consent; 6% of male coordinations in their 20s were interrupted for this reason.

Therefore, this study examines the effect of providing information that increases the willingness to donate as one of the measures to improve the quality of the donor pool. When a potential donor registered with the JMDP is matched with a specific patient, the matched donor receives a compatibility notice from the JMDP. Matched donors who respond to the notice by indicating their willingness to donate are then coordinated for transplantation. We added two new messages to the compatibility notice based on information published by the JMDP and conducted a field experiment in collaboration with the JMDP to test the effect of the additional messages.

The first message indicates that the number of HLA compatible donors per patient is low. If there are other potential donors with the same HLA type in the pool, one's own donation can be substituted for that compatible donor, and the utility of the patient's survival can be obtained without donating oneself. In addition, multiple donors (up to 10) can be matched and are coordinated simultaneously for a single patient. Thus, JMDP-mediated transplantation is in the nature of a public good, and thus, faces the standard free-rider problem. That is, potential donors with common HLA types will be more reluctant to donate than those with less common HLA type [@Bergstrom2009].

This problem is essentially the same as the volunteer dilemma, a situation in which public goods are produced by the cooperative behavior of only one person. In the volunteer dilemma, theory predicts that the probability of cooperative behavior by even one person decreases with group size, and this hypothesis has been confirmed in laboratory experiments [@Diekmann1985; @Diekmann1986; @Franzen1999; @Davis2017]. In addition, an interview study of previously matched donors [@Kurosawa2022] found that those with low donation intentions felt that they were "one of several donors," implying that the fact that their donation could be substituted by others discouraged them from donating. An important difference from the volunteer dilemma is that potential donors in the JMDP cannot know their own HLA type or the number of matched donors at the same time, so they cannot accurately guess the size of the group. As a result, potential donors may overestimate the number of other possible substitutes and be reluctant to donate. The first message aims to correct the behavior resulting from this misperception.

<!-- //TODO: 日本語の改訂の必要あり -->
第二のメッセージは早いコーディネーションが患者の移植到達率を高めるという情報を提示した。この情報は患者への移植によって得られる効用が経時的に減衰していくことを暗に提示している。もしその効用水準が時間に対して一定であると誤解しているならば、今コストを支払ってコーディネーションを受けるよりも将来コストを支払ってコーディネーションを受けようと考えるはずである。同じ意思決定が将来でも生じ、適合通知への返信が遅れてしまう可能性がある。こうした問題は行動経済学における現在バイアスによる先延し行動と似たような問題である[@ODonoghue2001]。先延ばし行動は将来の自分が価値を合理的に評価できると信じているが、実際はその時の効用を過剰に高く評価してしまうことで生じる。二つ目のメッセージは患者への移植によって得られる効用水準の経時的変化に関する誤解から生じる先延ばし行動を修正することを目的としている。
<!--  -->

We created four experimental arms to test the effects of the above messages. The first experimental arm sent the compatibility notice without the above two messages to matched donors (control group). The second and third experimental arms each added one of the above messages to the compatibility notice. The fourth experimental arm added both messages to the compatibility notice. We conducted a field experiment with 11,154 matched donors who received the compatibility notice between September 2021 and February 2022. We assigned participants to the experimental arms using weekly cluster randomization. We received coordination data at the end of June 2022, in collaboration with JMDP, to test the effects of the messages.

<!-- //TODO 日本語の改訂の必要あり -->
実験の結果、メッセージの効果は特定の性・年代にのみ影響を与えていることを発見した。本研究の主要な結果は二つある。第一に、患者一人当たりのHLA適合ドナーが少ないという情報のみを提供することは20代男性の提供意向を高めたが、他の性・年代では提供意向に統計的に有意な影響を与えていない。第二に、ドナーが早く見つかるほど移植到達率を高められるという情報を与えることは20代女性の全体の返信率に影響を与えていないが、短期間の返信（4日以内）に正の影響を与えている[^goal-day]。すなわち、この情報は返信行動そのものを促進しているよりむしろ、返信日数を短くしているといえる。このような効果は他の性・年代では確認されなかった。

[^goal-day]: JMDPは返信目安が10日以内であるということを適合通知に明記している。
<!--  -->

This study suggests that information can increase the willingness of potential donors to donate, providing practical insights for marrow donor programs around the world, including the JMDP. Similar to the JMDP, the German-based international marrow donor program, DKMS, and the U.S. marrow donor program, NMDP, have steadily increased their enrollment, but have faced challenges in keeping enrollees motivated and achieving coordination [@Switzer1999; @Switzer2004; @Haylock2022]. Previous studies have examined the effectiveness of donor leave laws [@Lacetera2014] and DKMS's own efforts to maintain donor motivation [@Haylock2022].

@Switzer2018 applied an intervention to a message sent by the NMDP when they ask matched potential donors to donate. Their intervention was a message that said, "Based on the information we currently have, you are in the unique position of likely being a perfect match for this patient," which was delivered over the phone to the potential donor whose HLA was a perfect match. Their experiment was not a fully randomized controlled trial and showed that this novel message did not increase the number of coordinations. Although our intervention is very close to this study, we show that the message effect is quite heterogeneous, affecting only certain genders and ages.

In addition, this study contributes to the economic study of costly prosocial behavior such as blood donation. Although hematopoietic stem cell transplantation (HSCT) and blood donation have some similarities, there are also some differences. In the case of blood donation, the time of the intention to donate and the time of the actual donation are the same, whereas in the case of HSCT, the two time points are different. Therefore, as mentioned earlier, maintaining the willingness of potential donors is a challenge for marrow donor programs. In the context of blood donation, previous studies have examined monetary incentives and non-monetary incentives such as symbolic rewards [@Mellstrom2008; @Lacetera2010]. As with HSCT, blood donation can also be considered a public good. @Wildman2009 used data on blood donors only and showed that free riding does not occur. In contrast, our study shows that information about the low number of HLA-compatible donors per patient increases the willingness of men in their 20s to donate, suggesting that they overestimate the number of HLA-compatible donors and engage in free-riding.

This paper is organized as follows. Section \@ref(experiment) provides an overview of the coordination process in the JMDP and details the field experiments; Section \@ref(result) presents the results; and Section \@ref(conclusion) provides discussion and conclusions.

# Field Experiment {#experiment}

```{r library, include=FALSE}
library(here)
library(tidyverse)
library(lubridate)
library(estimatr)
library(fixest)
library(grf)
library(modelsummary)
library(kableExtra)
library(flextable)
library(officer)
library(RCTtoolbox)
library(patchwork)
lapply(list.files(here("R/func"), "r", full.names = TRUE), source)

options(
  knitr.table.format = "markdown",
  kableExtra.auto_format = FALSE,
  modelsummary_stars_note = FALSE,
  modelsummary_factory_default = "flextable",
  modelsummary_factory_html = "kableExtra",
  modelsummary_factory_latex = "kableExtra",
  modelsummary_factory_word = "flextable",
  modelsummary_get = "broom"
)

data_root <- "D:/JMDPフィールド実験"
```

## Background: Coordination Process of JMDP {#background}

For a better understanding of the timing of our interventions, we outline the coordination process leading up to the donation of stem cells by potential donors enrolled in the JMDP. First, when a potential donor is matched with a patient enrolled in the JMDP, the JMDP office sends the donor the compatibility notice requesting a stem cell donation.[^SNS] The matched donor fills out a questionnaire and responds to the compatibility notice, indicating his or her willingness to donate.

[^SNS]: At the same time, the JMDP office sends a social networking message to the matched donors informing them that JMDP has sent the compatibility notice.

Coordination for the transplant then begins. The matched donor undergoes confirmatory typing within approximately one month. At this time, the coordinator explains the details of the donation process (bone marrow or peripheral blood stem cell collection) and asks the matched donors and their families about their willingness to donate. Matched donors can choose between two collection methods. In addition, the coordinating physician conducts an interview, medical examination and blood draw to test for infection and blood type. These tests are performed to determine if the matched donor meets the criteria established by the JMDP.

Patients can be matched with up to 10 compatible donors at one time. The patient's physician selects the most appropriate candidate from the matched donors who have undergone verification testing. Importantly, the matched donor does not have access to any information about the matched patient (e.g., how many other matched donors are available). Nor can the matched donor obtain this information from the coordinator or coordinating physician.

The matched donor who is selected as the best match must give final consent after being informed by the coordinator and coordinating physician. At the same time, a representative of the donor's family must also consent to the donation. After this, the selected donor cannot change his or her mind. After the final consent is given, the selected donor admits him/herself to hospital for approximately one week to undergo pre-operative examinations and preparation for the donation. The donor then undergoes a surgical procedure to collect the stem cells. The time from the confirmatory test to the collection is approximately 3-4 months.

## Experimental Design {#design}

```{r message, fig.cap="Intervention Messages"}
knitr::include_graphics("image/intervention.png")
```

Our experiment intervenes in the content of the compatibility notice in which JMDP requests a stem cell donation from a matched donor. Figure \@ref(fig:message) illustrates our intervention. Note that the standard compatibility notice should be responded to by the donor within 7 days. JMDP also encloses a handbook with the notice that describes the coordination process outlined in the previous subsection.

We have added two messages to the compatibility notice to facilitate coordination.[^pressure] The Probability message emphasizes the low number of matched donors per registered patient. As discussed in Section \@ref(intro), transplantation is a public good in the sense that if there are other potential donors with the same HLA type in the pool, one's own donation can be substituted for that compatible donor. Thus, as predicted by the volunteer dilemma, the more common the HLA type, the more reluctant the donor will be to donate [@Diekmann1985; @Bergstrom2009].

[^pressure]: In designing our intervention messages, we have been careful to avoid putting undue psychological pressure on potential donors. Specifically, first, we avoid language that sounds like an appeal. Second, we only use information that is publicly available from the JMDP. In addition, the risks of transplantation are explained in the usual way. The intervention message was approved by the Institutional Review Board of the Graduate School of Economics, Osaka University and the JMDP.

In the context of stem cell transplantation, however, the expectation of the size of the group influences the decision, because a matched donor cannot know the exact size of the group. Therefore, the higher a donor's expectation of the number of potential donors with the same HLA type, the more reluctant he or she will be to donate. If a donor's beliefs are too high, the Probability message would discourage free-riding and increase willingness to donate by adjusting beliefs downward. The opposite effect is also possible. If the donor's beliefs are underestimated, the Probability message may induce free-riding and reduce donation intentions by adjusting beliefs upward.

<!-- //TODO 日本語の改定待ち -->
Early Coordinationメッセージは早いコーディネーションが患者の移植率を高めることを提示している。適合通知への返信が遅れることによってコーディネーション期間が長くなると、患者の移植率が減少してしまう。したがって、このメッセージは患者への移植によって得られる効用が経時的に減衰していくことを暗に意味している。第\@ref(intro)節で述べたように、適合通知への返信は行動経済学における先延ばし行動が障害となりうる。もしあるドナーが患者への移植によって得られる効用水準が時間に対して一定であると信じているならば、今コストを支払ってコーディネーションを受けるよりも将来コストを支払ってコーディネーションを受けようと考えるはずである。そして、同じ意思決定が将来でも生じ、適合通知への返信が遅れてしまう可能性がある。このメッセージはこの先延ばし行動を抑制することを目的としている。仮にこのメッセージが全体の適合通知への返信率を高めなくても、早期返信を促進しているだろう。
<!--  -->

We set up four experimental groups to estimate the effects of the two intervention messages. Experimental group A received a standard compatibility message with no intervention messages (control group). Experimental groups B and C received the notice with the probability message and the early coordination message, respectively. Experimental group D received the notice with two intervention messages added at the same time. This experimental group was designed to test the negative effects of cognitive load caused by information overload.

```{r assignment, file = "R/schedule_data.r", tab.cap = "Assignment Schedule"}
```

Participants in the experiment were 11,154 matched donors who received the compatibility notice between September 2021 and February 2022. To maintain randomness to the best of the JMDP office's ability, we assigned experimental groups by cluster randomization on a weekly basis. We designed the experimental groups to be balanced across weeks and months whenever possible. Table \@ref(tab:assignment) summarizes the assignment schedule. In conducting the experiment, we obtained approval from the Graduate School of Economics, Osaka University, and the JMDP.

## Data and Empirical Strategy

```{r experiment-data, include=FALSE}
rawdt <- read_csv(here(data_root, "shaped.csv"), locale = locale(encoding = "cp932"))
use <- dataset(rawdt)
```

We received the coordination data at the end of June 2022 with the help of JMDP. The unit of observation is the experimental participant. As individual characteristics, the data record gender, age, number of coordination experiences, and prefecture-level residence area. As the coordination process, the data record whether each stage (response to compatibility notice, confirmatory typing, candidate selection, final consent, and collection) was reached. We use these variables as outcome variables. In addition, for responses to the notice, the data record the number of days to respond and the willingness to donate. If coordination was interrupted, the data record the reason for the interruption in three categories (patient reasons, donor non-health reasons, and donor health reasons). The analysis uses 11,049 matched donors living in Japan whose coordination (including interruptions) was completed.[^exclude]

```{r ongoing-balance, include=FALSE}
ongoing_f <- lm_robust(
  ongoing ~ treat,
  data = rawdt,
  cluster = if(FALSE) .$RCTweek,
  se_type = "HC1"
) %>%
{
  f <- summary(.)$fstatistic[1]
  numdf <- summary(.)$fstatistic[2]
  dendf <- summary(.)$fstatistic[3]
  p <- pf(f, numdf, dendf, lower.tail = FALSE)

  sprintf("F-test, p-value = $%1.3f$", p)
}
```

[^exclude]: One matched donor lived abroad. There were 104 matched donors with ongoing coordination at the time of data provision. The proportion of matched donors with ongoing matching is balanced across the experimental groups (`r ongoing_f`).

As additional data, we use the list of medical institutions published on the Internet by the JMDP.[^ref] This list includes complete addresses, availability of bone marrow collection (BM collection), and availability of peripheral blood stem cell collection (PBSC collection). We aggregated this list at the prefecture level, calculated the number of hospitals per 10 square kilometers, and merged it with the coordination data using the prefecture as the merging key. We consider this variable as the travel cost of coordination and donation.

[^ref]: <https://www.jmdp.or.jp/hospitals/view2/> (access date: August 4, 2022)

```{r summary, tab.cap = 'Overview of Field Experiment'}
summary_experiment(use$cs) %>%
  tbl()
```

Table \@ref(tab:summary) provides a summary of the field experiments. Panel A shows the intervention for each experimental group, and Panel B shows the sample size for each experimental group. Panel C is a balanced test of whether randomization was successful. The assignment of experimental groups is approximately random, since there is no average difference between experimental groups for any variable except age. However, age does vary across groups. The average age of experimental arm C is about one year younger than that of the control group.

Since we are interested in what information should be given to all potential donors, we want to identify the average treatment effect. Since the assignment of experimental groups should be independent of the potential outcomes (the outcome variable that would be observed if an experimental group is assigned) conditioned on a predetermined variable, we can identify the average treatment effect by the difference in means across experimental groups conditioned on the predetermined variable. Thus, we estimate the following linear probability model for individual $i$ who received the compatibility notice in week $w$ of month $m$:

$$
  Y_{imw} =
  \beta_1 \cdot \text{B}_{mw} + \beta_2 \cdot \text{C}_{mw} + \beta_3 \cdot \text{D}_{mw}
  + X'_i \gamma + \lambda_m + \theta_w + u_{imw},
$$

where $X_i$ is the individual attribute vector. We add month and week dummy variables $\lambda_m$ and $\theta_w$ to control for common shocks at a given time period. Our parameters of interest are $(\beta_1, \beta_2, \beta_3)$. When fixed effects are added, there seems to be no cause to generate correlations within clusters (experimental weeks) of unobservable elements $u_{imw}$. Thus, we use robust standard errors for statistical inference.[^LZ]

[^LZ]: We conducted a regression analysis with cluster standard errors as a robustness check, confirming no change in the main results presented in this paper.

# Experimental Results {#result}
## Effects on Reply and Intention {#intention}

First, we estimate the intervention effect on responses that are most likely to reflect the donor's intention to donate. The outcome variable for responses is a dummy variable taking one if the donor responded to the compatibility notice regardless of the donor's intention to donate. The response rate for the control group (experimental group A) is $88.35$%.

We decompose the message effect on responses into two effects. The first is the effect on responses associated with the intention to donate. The outcome variable is a dummy variable that takes one if the matched donor responds to the compatibility message and indicates a willingness to donate. The second is the effect on responses without intent to donate. The outcome variable is a dummy variable that takes one if the matched donor responded to the compatibility notice and did not indicate an intention to donate. In estimating these effects, we code the outcome variable for non-responders as zero and include them in the analysis sample. Thus, the sum of the two outcome variables is always equal to a dummy variable for response, so that the sum of the effects on positive and negative intentions is the effect on response. In the control group, the response rate with positive intentions is $55.33$%, while the response rate with negative intentions is $33.03$%. Thus, $62.63(=55.33/88.35)$% of respondents are positive in their offer.

```{r exogenous-balance, include=FALSE}
exogenous_f <- lm_robust(
  exg_stop_reply ~ treat,
  data = use$cs,
  cluster = if(FALSE) RCTweek,
  se_type = "HC0"
) %>%
{
  f <- summary(.)$fstatistic[1]
  numdf <- summary(.)$fstatistic[2]
  dendf <- summary(.)$fstatistic[3]
  p <- pf(f, numdf, dendf, lower.tail = FALSE)

  sprintf("F-value, p-value = %1.3f", p)
}
```

It is possible that coordination is interrupted for patient reasons before a matched donor responds. Since this happens independently of the matched donor's intentions, we exclude from our analysis sample the $0.5$--$0.7$% that fall into such a case in each experimental group. This case is balanced across experimental groups (`r exogenous_f`).

```{r reg-stock, tab.cap = 'Linear Probability Model of Reply and Intention'}
lm_all_stock(use$stock) %>%
  tbl()
```

Table \@ref(tab:reg-stock) presents the estimation results of the linear probability model. The odd columns include only the experimental group dummy as an explanatory variable, corresponding to a simple difference in means. The even columns control for individual attribute, month, and week fixed effects in addition to the experimental group dummies. The estimated results show that all experimental groups, with and without covariates, have no statistically significant effects on responses or intentions. As an alternative method, we estimate a logit model (Table \@ref(tab:logit-stock)) and obtain similar results (95% confidence intervals for odds ratios include 1).

```{r coefplot-reg-stock-subset, fig.cap = 'Effect on Reply and Intentions by Gender and Age Group. Note: These plots show the average effect (and associated 95% confidential interval) on each outcome by gender and age group. We use robust standard errors We control number of past coordinations, number of hospitals per 10 square kilometers, number of hospitals with PBSC collection per 10 square kilometers, number of hospitals with BM collection per 10 square kilometers, month dummies, and week dummies.'}

lm_subset_stock(use$stock) %>%
  coefplot()
```

Next, to test for heterogeneity in the message effect, we divide the sample into four subsets by gender and age group (under 30 or not) and estimate the message effect in each subset. Figure \@ref(fig:coefplot-reg-stock-subset) shows the coefficient plots. The results show that experimental groups B and D, which include the Probability message, increase the response rate of men in their 20s by about 6 points ($8.06$% increase, since the control mean is $74.4$%), which is statistically significant at the 5% level. In particular, experimental group B, to which only the Probability message was added, increases responses with positive intentions by about 10 points ($25.91$% increase, since the control mean is $38.6$%), which is also statistically significant at the 1% level (Table \@ref(tab:reg-young-male-stock)). However, for the other gender and age groups, our intervention has no statistically significant effect on responses or intentions.

In the control group, about 50(=38.6/74.4)$% of males in their 20s who responded to the compatibility notice were willing to donate, which is lower than the willingness rate of respondents in the other gender and age groups (60%).[^cal] Experimental group B (Probability message) raises the intention ratio of male repliers in their 20s from 50% to 60% $(=(38.6 + 10)/(74.4 + 6))$. In addition, young men are reported to have better transplant outcomes than other genders and ages. Taken together, we can say that the Probability message improves the efficiency of coordination in the sense that it encourages behavioral change (initiation of coordination) in desirable donors.

[^cal]: For women in their 20s, $59 (=51.6/87.4)$%; for men over 30, $66 (=59.0/89.1)$%; for women over 30, $62 (=58.8/94.6)$%.

## Random Causal Forest {#rcf}

```{r rcf-int, include=FALSE}
rcf <- random_causal_forest(use$cs)
```

To explore the heterogeneity of intervention effects further, we use random causal forests (RCF), which allow us to test the heterogeneity of treatment effects in a fully nonparametric way [@Athey2016; @Wager2018]. The method is based on a regression tree algorithm and estimates the average treatment effect conditional on observed characteristics. This method has been used in a variety of contexts, including labor [@Davis2017], education [@Carlana2022], and energy conservation [@Murakami2022].

The algorithm splits the sample into two subsamples (leaves) using one of the covariates $X_j$. Specifically, the algorithm divides the sample into a sample for which $X_j \le x$ and a sample for which $X_j > x$. The regression tree determines a specific threshold $x$ to minimize the mean squared error of the outcome variable. Since the RCF aims to estimate the average treatment effect of a leaf (conditional average treatment effect), the threshold $x$ is set to minimize the expected mean squared error of the predicted treatment effect. This minimization is achieved by increasing the variance of the conditional mean treatment effect across leaves (heterogeneity) and decreasing the variance within leaves. This splitting process is repeated for each leaf until the termination condition is reached. RCF predicts the conditional mean treatment effect at the terminal leaf.

The disadvantage of the regression tree algorithm is that the variance of the predictions becomes large (overfitting), which reduces the accuracy of the predictions. To prevent this, RCF introduces an algorithm called the ensemble method. It creates thousands of unduplicated subsamples of the data and grows a tree with each subsample. The final result is the average of the predictions from thousands of trees.[^tech-detail]

Roughly speaking, RCF predicts treatment effect from observed characteristics. In other words, it can predict treatment effects based on individual characteristics, even for individuals who did not receive the intervention. This method must assume that treatment assignment is conditionally independent of the potential outcome variable. Since the experimental group is approximately randomly assigned, we can use this method. In this subsection, we focus on the effect on responses with intentions. The covariates used in the RCF are gender, age, past coordination experience, and the density of hospitals in the area of residence.

[^tech-detail]: For technical details, see @Athey2016 and @Wager2018. This study also uses a technique called generalized random forests, which treats RCF as a special case, but the intuition remains the same. See @Athey2019 and @Athey2019a for details on generalized random forests.

```{r boxplot-rcf-int, fig.cap='Boxplot of Predicted Treatment Effects by Gender and Age. Notes: Blue fitted line represents GAM smoothing. Covariates are gender, age, number of past coordinations, number of hospitals per 10 square kilometers, number of hospitals with PBSC collection per 10 square kilometers and number of hospitals with BM collection per 10 square kilometers.'}

boxplot_effect(rcf)
```

```{r include=FALSE}
rcf$pred %>%
  dplyr::filter(male == "Males") %>%
  dplyr::filter(30 < age & age <= 40) %>%
  dplyr::filter(treat == "Message B") %>%
  mutate(high = if_else(effect >= 0.1, 1, 0)) %>%
  group_by(high) %>%
  summarize_at(vars(coordinate:BM_per_area), list(~ mean(.)))

rcf$pred %>%
  dplyr::filter(45 < age) %>%
  dplyr::filter(treat == "Message C") %>%
  mutate(positive = if_else(effect >= 0, 1, 0)) %>%
  group_by(male, positive) %>%
  summarize_at(vars(coordinate:BM_per_area), list(~ mean(.)))

rcf$pred %>%
  group_by(treat) %>%
  summarize_at(vars(effect), list(~var(.)))
```

Figure \@ref(fig:boxplot-rcf-int) plots the distribution of predicted treatment effects for each experimental group for responses with intentions by age. Notably, the effect of experimental group B is positive for all males under the age of 25. As a result, the RCF shows that the average effect of experimental group B for men in their 20s is 12.1 points, which is close to the results of the subsample analysis of the linear probability model presented in Figure \@ref(fig:coefplot-reg-stock-subset) (see Table \@ref(tab:rcf-int-cate)). For some men in their 30s and 40s, the effect of experimental group B is more than 10 points. These men live in areas with a relatively large number of hospitals and have lower coordination and donation travelling costs.

The effects of experimental group C, with only the Early Coordination message added, are largely heterogeneous. For women in their early 30s, most treatment effects are negative. For men and women in their late 40s and older, the median treatment effect is positive but widely distributed. Surprisingly, among men and women in this age group, those with positive experimental group C effects live in areas with relatively few hospitals (high travelling costs).

```{r rcf-int-corr, tab.cap='Correlation of Predicted Treatment Effects'}
cf_corr_effect(rcf) %>%
  tbl()
```

Experiment group D adds both the Probability message (experimental group B) and the Early Coordination message (experimental group C). Thus, if the matched donor fully understands the information in experimental group D, the effect of experimental group D should be the sum of the effects of experimental groups B and C. To test this point, columns (1)--(4) of Table \@ref(tab:rcf-int-corr) regress the predicted treatment effect of experimental group D on the sum of the predicted effects of experimental groups B and C. For each sex and age group, a 1-point increase in the sum of the effects of experimental groups B and C increases the effect of experimental group D by 0.3--0.4 points. Since the 95% confidence interval does not include 1, this increase is statistically significantly less than 1 point. This result suggests that matched donors do not fully understand the information in experimental group D, resulting in cognitive load due to information overload.

A matched donor who does not receive complete information would either value either the Probability message or the Early Coordination message, or would discount the two pieces of information equally. To test this point, columns (4)--(8) of Table \@ref(tab:rcf-int-corr) regress the predicted treatment effects for experimental group D on the predicted effects for experimental group B and for experimental group C. The results show that for men and women in their 20s, the partial correlations between experimental groups C and D are stronger than those between experimental groups B and D, suggesting that they value the Early Coordination message more than the Probability message. Thus, despite the Probability message, experimental group D is ineffective for men in their 20s.

Interestingly, for men and women over 30, the partial correlations between experimental groups C and D are weaker than those between experimental groups B and D. In other words, they value the probability message more than the Early Coordination message. Thus, while the median effect of experimental group C for men and women in their late 40s and older is about 8 points, the median treatment effect of experimental group D is almost zero.

## Response Speed to Notification {#reply-speed}

Early Coordinationメッセージは早いコーディネーションが患者の移植率を高めるという事実を提供している。したがって、このメッセージは適合通知への早期返信を促している可能性がある。この可能性を検証するために、我々は特定の期間以内に返信する確率への効果を線形確率モデルで推定する。

アウトカム変数は潜在ドナーが$d$日以内に返信したならば1を取るダミー変数である。$d$日以降に返信した・返信しなかった場合、アウトカム変数は0となる。$d$の値を十分に大きくすれば、この分析は第\@ref(intention)節の結果と一致する。さらに、第\@ref(intention)節と同様に、我々はドナーの意向の視点から二つの効果に分解する。一つは提供意向を伴う$d$日以内の返信への効果である。アウトカムは$d$日以内に返信し、かつ提供の意向を示したならば1を取るダミー変数である。もう一つは提供意向を伴わない$d$日以内の返信への効果である。アウトカムは$d$日以内に返信し、かつ提供の意向を示さなければ1を取るダミー変数である。$d$日以降に返信した・返信しなかった場合、これらのアウトカムも0とコーディングされる。我々は$d = \{4, 7, 10, 14, 21, 28\}$に焦点を当てる。

```{r reply-speed-ctrl, include=FALSE}
ctrl <- with(subset(use$cs, treat == "A" & reply == 1), mean(days_reply))
ctrl_positive <- with(subset(use$cs, treat == "A" & reply == 1 & intention == 1), mean(days_reply))
ctrl_negative <- with(subset(use$cs, treat == "A" & reply == 1 & intention == 0), mean(days_reply))
ctrl_max <- with(subset(use$cs, treat == "A" & reply == 1), max(days_reply))
ctrl_7days <- with(subset(use$flow, treat == "A" & within == 7 & outcome == "Reply"), mean(value))
ctrl_positive_7days <- with(subset(use$flow, treat == "A" & within == 7 & outcome == "Positive intention"), mean(value))
```

コントロール群では、返信者の平均的な返信日数は`r round(ctrl)`日である。また、正もしくは負の意向を伴う返信の平均返信日数はそれぞれ`r round(ctrl_positive)`日・`r round(ctrl_negative)`日である。最長の返信日数は`r ctrl_max`日である。加えて、適合通知に目安として記載されている7日以内の返信は`r round(ctrl_7days*100)`%であり、正の意向を伴う7日以内の返信は`r round(ctrl_positive_7days*100)`%である。

```{r est-subsample-flow, include=FALSE}
est_sub_flow <- lm_subset_flow(use$flow)
```

```{r young-male-flow, fig.cap='Effect on Reply within Specific Days after Sending Notification among Males Less than 30. Notes: These plots show the average effect (and associated 95% confidential interval) on each outcome. We use robust standard errors We control number of past coordinations, number of hospitals per 10 square kilometers, number of hospitals with PBSC collection per 10 square kilometers, number of hospitals with BM collection per 10 square kilometers, month dummies, and week dummies.'}

coefplot(est_sub_flow, male == 1 & age_less30 == 1)
```

先の小節で見たように返信や意向への効果は異質的であるので、この小節は性・年代でサブサンプルに分割して、返信日数への効果の異質性に注目する[^speed-older]。図\@ref(fig:young-male-flow)は20代男性の結果である。このサブグループでは、我々は確率メッセージのみを加えた実験群Bが提供意向を伴う全体の返信率を10ポイント程度高めていたことをすでに明らかにしている（図\@ref(fig:coefplot-reg-stock-subset)）。図\@ref(fig:young-male-flow)はその効果が14日以内の返信から生じていることを示している。実験群Bは提供意向を伴う10日以内の返信を（統計的に有意ではないが）5ポイント程度高めており、14日以内の返信を10ポイント程度高めている。すなわち、実験群Bは提供意向を伴う10日以内の返信を5ポイント、提供意向を伴う10--14日以内の返信を5ポイント高め、これらが全体の返信率を10ポイント高めていることにつながっている。また、このグループでは、早期返信を促している可能性のある実験群C（Early Coordinationメッセージ）が短期間の返信を高めているということはなかった。

[^speed-older]: 30歳以上の男女については補論の図\@ref(fig:old-male-flow)と図\@ref(fig:old-female-flow)に示す。これらのグループでは特徴的な結果がない。

```{r young-female-flow, fig.cap='Effect on Reply within Specific Days after Sending Notification among Females Less than 30. Notes: These plots show the average effect (and associated 95% confidential interval) on each outcome. We use robust standard errors We control number of past coordinations, number of hospitals per 10 square kilometers, number of hospitals with PBSC collection per 10 square kilometers, number of hospitals with BM collection per 10 square kilometers, month dummies, and week dummies.'}

coefplot(est_sub_flow, male == 0 & age_less30 == 1)
```

しかしながら、実験群Cは20代女性の早期返信を促している可能性がある。図\@ref(fig:young-male-flow)は20代女性の結果である。図\@ref(fig:coefplot-reg-stock-subset)より、実験群Cは20代女性の全体の返信率に統計的に有意な影響を与えていない。一方で、この実験群は4日以内の返信率を6ポイント程度高めており、これは5%水準で有意である。この効果は28日以内の返信率でも維持している。すなわち、4--28日の返信率の変動はコントロール群と比較して同じである。そして、実験群Cの全体の返信率に対する点推定は3ポイントなので、この実験群は28日以降の返信率を3ポイント下げている。したがって、実験群Cは4日以内の返信率を高め、それ以降の返信率を若干減らしている。言い換えれば、Early Coordinationメッセージは20代女性の早期返信を促している。4日以内の返信の増加は正の意向を伴う返信と負の意向を伴う返信を同程度高めていることから生じている。

また、Early Coordinationメッセージを含む実験群Dの返信への効果も実験群Cと同様の傾向である。ただし、実験群Cの結果と異なり、4日以内の返信の増加は正の意向を伴う返信のみの増加から生じている。

## Effects on the Coordination Process {#process}

Finally, we examine the impact on each step of the coordination process after the response to the compatibility notice. As explained in Section \@ref(background), the coordination process consists of four stages: confirmatory typing, candidate selection, final consent, and collection. We use as outcome variable a dummy variable that takes 1 if a matched donor has reached each stage.

As in the analysis in Section \@ref(intention), we exclude samples in which matching appears to have been interrupted independently of matched donor willingness. When estimating the effect on confirmatory typing, we exclude cases of interruption for reasons related to the patient. Since the patient's physician is likely to select the healthiest matched donor at the time of candidate selection, cases of interruption for donor health reasons after candidate selection are considered to have occurred independently of the donor's willingness. Thus, when estimating the effects on candidate selection, final consent, and donation, we exclude samples interrupted for patient reasons and samples interrupted for donor health reasons after candidate selection. However, we must be cautious in our interpretation because sample exclusion alone may not completely eliminate physician decision making. In the control group, 24% of eligible donors underwent confirmatory testing, 8% became candidates, and 6% ultimately donated.

```{r est-full-coordination, tab.cap = 'Linear Probability Model of Coordination Process'}

lm_all_coordination(use$coordination) %>%
  tbl()
```

Table \@ref(tab:est-full-coordination) shows the full sample estimation results. The results show that experimental groups B and D, which include probability messages, increase the rate of confirmatory typing by about 3 percentage points, which is a statistically significant effect. This effect is larger than the effect on responses. This is because the likelihood of coordination being interrupted for donor reasons, including health reasons, is lower in experimental groups B and D than in the control group. Thus, although experimental groups B and D do not increase the overall number of people willing to donate, they do maintain the intention to donate, which contributes to the reduction in coordination dropouts.

The effect of experimental groups B and D on the stage after candidate selection is less than 1 percentage point and not statistically significant. This should be interpreted with caution. Since our intervention did not affect demand (number of patients), if our intervention increased the number of people who reached confirmatory typing, it should have increased the number of people who were not selected as candidates for exogenous reasons. In experimental group B and control group, the number of potential donors who reached confirmatory typing was 774 and 564, respectively. Therefore, experimental group B would have increased the number of confirmatory typings by 210. The number of potential donors who were not selected as candidates due to patient or donor health reasons was 556 in the experimental group B and 385 in the control group. This means that experimental group B has 171 more people who were not selected as candidates for exogenous reasons. Thus, the estimates include not only the effect of our intervention, but also the effect of the demand for stem cell transplants.

```{r coefplot-reg-subsample-coordination, fig.cap='Effect on Coordination by Gender and Age Group. Note: These plots show the average effect (and associated 95% confidential interval) on each outcome by gender and age group. We use robust standard errors We control number of past coordinations, number of hospitals per 10 square kilometers, number of hospitals with PBSC collection per 10 square kilometers, number of hospitals with BM collection per 10 square kilometers, month dummies, and week dummies.'}

lm_subset_coordination(use$coordination) %>%
  coefplot()
```

Figure \@ref(fig:coefplot-reg-subsample-coordination) divides the sample into four subsets by gender and age group (under 30 or not) and estimates the message effect in each subset. The results show that experimental group B increases the proportion of men in their 20s who reach confirmatory typing by about 8 percentage points, which is statistically significant. Thus, it is possible that experimental group B not only increases the willingness of men in their 20s to donate, but also maintains it. Experimental group B has no statistically significant effect on candidate selection and final agreement among men in their 20s. However, the effect on donation is about 4 percentage points and is statistically significant at the 10% level (Table \@ref(tab:reg-young-male-coordination)). As noted earlier, this effect may reflect not only the effect of our intervention, but also the demand for stem cell transplants. If younger males have better transplant outcomes, then the demand for stem cell transplants may be higher in this generation than in other genders and ages. The effect on donation may include this effect.

# Discussion and Conclusions {#conclusion}

本研究はJMDPに登録した潜在ドナーの提供意向を高めるための情報提供の効果を検証した。その結果、一人の患者あたりのHLA適合ドナーが少ないという情報（Probability message）は20代男性の提供意向を10ポイント程度高め、確認検査への到達率も8ポイント程度高めている。人数に換算すると、この情報提供は提供に積極的な人を600人から756人に増やし、確認検査への到達した人を346人から462人に増やしている。さらに、幹細胞移植の需要の影響を含んでいるが、この情報はドナーの移植率を5ポイント高めている。人数に換算すると、Probability messageは71人から121人に増やしている。ただし、早いコーディネーションが患者の移植率を高めるという情報（Early Coordination message）を同時に提供すると、彼らはこのメッセージに比重を置いて意思決定するので、Probability messageの正の効果は消えてしまう。これらの結果は20代男性がHLA適合ドナーの数について過度な期待を持っており、フリーライド行動を取っていることを示唆している。

他の性・年代でProbability messageが統計的に有意な影響を与えていない原因は二つあると考えられる。第一に、20代男性と比較して、他の人はHLA適合ドナーの数を正しく見積もっているかもしれない。この場合、Probability messageは潜在ドナーの意思決定に全く影響を与えないはずである。第二に、20代男性と他の性・年代の利他的な選好が異なるという可能性である。経済学における利他行動の研究では、利他行動の動機が自身の利他行動そのもので効用を得るウォームグローと公共財の生産など利他行動の結果で効用を得る純粋利他性の二つに大別される[@Andreoni1990]。ウォームグローが相対的に強い人ほど、他者の行動に関心がないので、フリーライド行動を取る可能性が低くなる。したがって、20代男性と比較して、他の人はウォームグロー選好が利他行動の主動力となっているのかもしれない。要するに、Probability messageの異質性は信念の違いか動機の違いかで説明ができると考えられる。

また、Early Coordination messageは20代女性の全体の返信率に影響を与えていないが、短期間の返信（4日以内）に正の影響を与えている。これは返信行動そのものを促進しているよりむしろ、返信日数を短くしていることを示唆している。我々のデータ制約上、このメッセージが患者の移植までの期間を短くしているかどうかを検証できないが、この情報が少なくともコーディネーション期間の短縮に貢献している。他の性・年代で効果がなかったのは、他の人がこの情報をもともと持っている可能性が考えられる。

本研究はフィールド実験によって情報提供の因果効果をクリアに識別できるが、先に述べたメカニズムを識別できるようなデータ・実験設計ではないことに限界がある。しかしながら、本研究は実務的な含蓄がある。第\@ref(intro)節で述べたように、造血幹細胞移植は提供の意向を示す時点と実際の提供の時点が異なるので、潜在ドナーの意向を維持することが骨髄ドナープログラムの課題となっている。特に、移植成績の良い若年ドナーが意向を維持できず、脱落しやすい。本研究は患者とマッチしたときに、骨髄ドナープログラムの事務局が与える情報によって若年潜在ドナーの行動変容を促せる可能性を提示しており、この課題を解決するための施策の一つとなるだろう。とくに、他者のHLA適合情報は、移植成績の良いドナーがコーディネーションに進みやすくなるという意味で、コーディネーションの効率性を高めるだろう。しかしながら、情報提供が効果をないことを示す研究[e.g. @Switzer2018]もあるので、他国の骨髄ドナープログラムでの情報提供の効果検証が期待される。

# Appendix {-}

<!-- //NOTE ロジット推定 -->

```{r logit-stock, tab.cap = 'Logit Model of Reply and Intention'}
logit_all_stock(use$stock, TRUE) %>%
  tbl()
```

```{r logit-coordination, tab.cap = 'Logit Model of Coordination'}
logit_all_coordination(use$coordination, TRUE) %>%
  tbl()
```

<!-- //NOTE 30歳未満の男性の回帰分析 -->

```{r reg-young-male-stock, tab.cap = 'Linear Probability Model of Reply and Intentions for Males Less Then 30 Years'}
stock_young_male <- use$stock$male == 1 & use$stock$age < 30
lm_all_stock(use$stock[stock_young_male,]) %>%
  tbl()

# wildbs_subset_stock(use$stock, male == 1 & age < 30, treat = c("B", "D")) %>%
#   tbl()
```

```{r reg-young-male-coordination, tab.cap = 'Linear Probability Model of Coordination among Males'}
coord_young_male <- use$coordination$male == 1 & use$coordination$age < 30
lm_all_coordination(use$coordination[coord_young_male, ]) %>%
  tbl()

# wildbs_subset_coordination(use$coordination, male == 1 & age < 30, treat = "B") %>%
#   tbl()
```

<!-- //NOTE Additional analysis of flow data -->

```{r old-male-flow, fig.cap='Effect on Reply within Specific Days after Sending Notification among Males More than 30. Notes: These plots show the average effect (and associated 95% confidential interval) on each outcome. We use robust standard errors We control number of past coordinations, number of hospitals per 10 square kilometers, number of hospitals with PBSC collection per 10 square kilometers, number of hospitals with BM collection per 10 square kilometers, month dummies, and week dummies.'}

coefplot(est_sub_flow, male == 1 & age_less30 == 0)
```

```{r old-female-flow, fig.cap='Effect on Reply within Specific Days after Sending Notification among Females More than 30. Notes: These plots show the average effect (and associated 95% confidential interval) on each outcome. We use robust standard errors We control number of past coordinations, number of hospitals per 10 square kilometers, number of hospitals with PBSC collection per 10 square kilometers, number of hospitals with BM collection per 10 square kilometers, month dummies, and week dummies.'}

coefplot(est_sub_flow, male == 0 & age_less30 == 0)
```

<!-- //NOTE RCF -->

```{r rcf-int-cate, tab.cap = 'Conditional Average Treatment Effect Estimated by RCF'}
tbl(rcf$cate)
```

# References {-}