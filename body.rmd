---
title: |
  Only You:
  A Field Experiment of Text Message to Prevent Free-riding in Japan Marrow Donor Program
author:
  - Hiroki Kato (Hitostubashi Institute for Advanced Study, Hitotsubashi University, Tokyo, Japan)
  - Fumio Ohtake (Center for Infectious Disease Education and Research (CiDER), Osaka University, Osaka, Japan)
  - Saiko Kurosawa (Department of Oncology, Ina Central Hospital, Nagano, Japan)
  - Kazuhiro Yoshiuchi (Graduate School of Medicine, Tokyo University, Tokyo, Japan)
  - Takahiro Fukuda (Department of Hematopoietic Stem Cell Transplantation, National Cancer Center Hospital, Tokyo, Japan)
date: "Last updated on `r format(Sys.Date(), '%B %d, %Y')`"
bibliography: biblio.bib
output:
  bookdown::word_document2:
    numnber-sections: true
    toc: false
params:
  is_fe: TRUE
  is_cluster: TRUE
  se_type: stata
---

```{r include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  error = FALSE,
  message = FALSE,
  dev = "ragg_png",
  fig.width = 15,
  fig.height = 10
)
```

# Introduction {#intro}

同種造血幹細胞移植は白血病などの血液病に対する最も再発率の低い治療法の一つである。この治療法では、(1)抗がん剤や放射線によって異常な細胞と健康な造血幹細胞を同時に殺し、(2)他者から提供された健康な造血幹細胞を移植する。骨髄移植（造血幹細胞移植）における要件は、ドナーのHLAと呼ばれる白血球の型が患者のHLAと一致していることである[^hapro]。ランダムに選ばれた二人のマッチング確率は1%未満である一方で、兄弟姉妹間で一致する可能性が最も高く、その確率は30%程度である。また、親子間のマッチング確率はかなり低い。親族の中に適合するドナーがいなければ、患者は近親者以外からドナーを探さなければならない。日本において、患者は一般的に日本骨髄バンク（JMDP）を介して非近親者のドナーを探すことになる。しかしながら、JMDPによるコーディネーションは移植に至るまで長時間を要し、登録患者の60%のみが移植を受けられない [@Hirakawa2018]。

[^hapro]: 近年、ハプロ移植と呼ばれる、半合致したHLAを持つ近親者間での移植が広がりつつある。加えて、母子をつなぐさい帯や胎盤に含まれる血液細胞の移植（さい帯血移植）も同様に人気になっている。骨髄移植と異なり、HLAが完全に合致していなくても、さい帯血移植は実施できる。

患者の生存確率を高めるためのドナープールに対する介入は二種類ある。第一に、潜在的なドナーの人数を増やして、マッチング確率を高めるような政策である。4人未満のドナーと合致する患者と比較して、200人以上のドナーと合致する患者の移植率は45%から74%に上昇する [@Hirakawa2018]。しかしながら、2000年から2015年にかけて潜在的なドナーの数は約二倍に増えたにもかかわらず、初回マッチング確率は5%程度しか増えていない [@Takanashi2016] [^reason]。したがって、潜在的なドナーを増やすことの限界便益は小さいので、プールの規模を拡大することは非効率的であるだろう。

[^reason]: これは珍しいHLAの型を持つ新しいドナーの確率が低いからである。

第二の政策はドナープールに提供を断らない潜在的なドナーの比率を高めることである。この種の政策はドナープールの質に貢献するものである。@Hirakawa2018 は多くの移植コーディネーションはドナー側の都合により、コーディネーションの第一過程である確認検査の前に中断していることを示している（コーディネーションの過程は第 \@ref(background) 節を参照）。したがって、提供の意思の強い多くの潜在ドナーでできたプールを作ることは移植率を高めるだろう。また、ドナープールの質を改善する政策の限界便益はドナープールの規模を拡大する政策のそれよりも高いだろう。

そこで、本研究はドナープールの質を改善する政策の一つとして情報提供の効果を検証する。JMDPに登録した人がある患者の潜在的なドナーとなると、潜在ドナーはJMDPから適合通知を受け取る。そして、提供意思を示して適合通知に返信する潜在ドナーは移植のためのコーディネーションを受ける。我々はJMDPによって公開されている情報に基づいて適合通知に新規のメッセージを加えて、追加メッセージの効果を検証するフィールド実験を2021年9月から2022年2月にかけて実施した。介入メッセージは二つある。第一に、患者一人あたりの潜在的なドナーの数が少ないという情報（確率情報）である。患者一人につき複数の潜在的なドナーが同時にコーディネーションを受けるので、JMDPを通じた幹細胞移植は公共財の性質を持つ。したがって、同時にコーディネーションを受けている潜在的なドナーが多ければ多いほど、フリーライドするインセンティブが強くなる。第一のメッセージはコーディネーション進行中のドナーの数に関する過剰な期待によって生じるただ乗り行動を妨げることを目的としている。もう一つのメッセージはJMDPに登録した患者の半分しか移植を受けられないというもの（利他情報）である。この情報は幹細胞提供という利他行動の価値を高めることを目的としている。また、このメッセージは候補となるドナーが早く見つけられるほど、移植率を高められることも明記して、適合通知に早く返信してもらうことを目的としている。

我々はJMDPに実験機関に適合通知を受け取った人に関するコーディネーション過程のデータの提供を依頼し、情報を提供することの効果を分析した。我々のフィールド実験は情報提供の効果は異質的であることを示している。確率情報は移植成績がよいにもかかわらず適合通知への返信率が低い若年層の男性に効果的であるが、利他情報は若年男性に効果的でなかった。さらに、二つの情報を同時に提供する介入も、利他情報に強く影響を受けてしまうために、効果的でなかった。

# Field Experiment {#experiment}

```{r library, include=FALSE}
library(here)
library(tidyverse)
library(lubridate)
library(estimatr)
library(fixest)
library(grf)
library(modelsummary)
library(kableExtra)
library(flextable)
library(officer)
library(RCTtoolbox)
library(patchwork)
lapply(list.files(here("R/func"), "r", full.names = TRUE), source)

options(
  knitr.table.format = "markdown",
  kableExtra.auto_format = FALSE,
  modelsummary_stars_note = FALSE,
  modelsummary_factory_default = "flextable",
  modelsummary_factory_html = "kableExtra",
  modelsummary_factory_latex = "kableExtra",
  modelsummary_factory_word = "flextable",
  modelsummary_get = "broom"
)

data_root <- "D:/JMDPフィールド実験"
```

## Background: Coordination Process of JMDP {#background}

フィールド実験の介入のタイミングの理解を促すために、JMDPに登録した潜在ドナーによる幹細胞の提供までのコーディネーション過程を概観しておく。はじめに、潜在ドナーがJMDPに登録した患者とマッチすると、JMDP事務局は潜在ドナーに幹細胞提供を依頼する適合通知（compatibility notice）を送付する[^SNS]。潜在ドナーは問診票を記入し、提供意思の有無を示して、適合通知に返信する。

[^SNS]: JMDPは同時に潜在ドナーにJMDPが適合通知を送付したことを知らせるSNSメッセージを送付する。

その後、移植に向けたコーディネーションが始まる。潜在ドナーはおよそ1カ月以内に確認検査（confirmatory typing）を受ける。この段階では、コーディネーターは提供手順の詳細（骨髄採取もしくは末梢血幹細胞採取）を説明し、潜在ドナーとその家族に提供の意向を調査する。潜在ドナーは二つの採取方法を選べる。加えて、コーディネーター医師が問診、検診、感染症の有無と血液型を調べる採血をする。これらのテストは潜在ドナーがJMDPの定める基準に満たしているかどうかを検査する。

患者は同時に最大10人の潜在ドナーとのコーディネーションを受けられる。患者の医師は確認検査を受けた潜在ドナーから最も適切な候補者を選ぶ。重要なこととして、潜在ドナーはマッチしている患者の情報（他の潜在ドナーと何人マッチしているかなど）を一切知ることができない。また、潜在ドナーがコーディネーターやコーディネーター医師からそのような情報を得ることもできない。

最も適切な候補者として選ばれた潜在ドナーはコーディネーターやコーディネーター医師からの説明を受けた後に、最終同意をする必要がある。同時に、ドナーの家族の代表者も採取に同意しなければならない。ただし、これ以降、潜在ドナーは意向を変えられない。最終同意後、潜在ドナーは術前検査や採取の準備を受けるために1週間程度の入院をする。この後、ドナーは幹細胞採取の手術を受ける。確認検査から採取までの時間はおよそ3--4カ月である。

## Experimental Design {#design}

```{r message, fig.cap="Intervention Messages"}
knitr::include_graphics("image/intervention.png")
```

我々の実験はJMDPが潜在ドナーに幹細胞提供を依頼する適合通知の内容に介入を施す。図 \@ref(fig:message) は我々の介入を示す。適合通知は提供ドナーが7日以内に返信するべきことを注記している。また、JMDPは適合通知と一緒に前小節で概観したコーディネーション過程を記述したハンドブックを同封している。

我々はコーディネーションを促進するために適合通知に二つのメッセージを加えた[^pressure]。確率メッセージはJMDPに登録した患者あたりの潜在ドナーの数が少ないことを強調している。一人以上の潜在ドナーが一人の患者とマッチするので、幹細胞提供は公共財の性質を有している。標準的な経済学理論は潜在ドナーがただ乗りするインセンティブを持っており、提供のやる気を削いでしまうことを提示している。また、貢献者の数が多いほど、ただ乗りするインセンティブは強くなるはずである。これまでの実証研究はこの仮説に対して混在したエビデンスを示している<!--//TODO: エビデンスの追加--->。我々は潜在ドナーが他の潜在ドナーの数について過度に多く見積もっており、標準的な経済学理論に従ったただ乗り行動を取っていると考えた。よって、確率メッセージは他の潜在ドナーの数の信念を下方修正することを通じて、提供意向を高めることを目的としている。

[^pressure]: 介入メッセージを作成したとき、我々は潜在ドナーに対して過度な心理的プレッシャーを与えないように配慮している。具体的には、第一に、嘆願調のような表現を避けている。第二に、JMDPが公開している情報のみを用いている。また、移植リスクは通常通り説明している。

第二のメッセージはEarly Coordinationメッセージである。このメッセージは登録患者の半数程度しか移植を受けられないことを強調して、潜在ドナーの利他性を刺激している。さらに、このメッセージは適切な潜在ドナーが早く見つかるほど、患者の生存率が高くなることを伝えている。<!--//TODO: 簡単に仮説を明記する-->

我々は二つの介入メッセージの効果を推定するために四つの実験群を設けた。実験群Aは介入メッセージなしの標準的な適合通知を送付した（コントロール群）。実験群BとCはそれぞれ確率メッセージとEarly Coordinationメッセージを追加した適合通知を送付した。実験群Dは二つの介入メッセージを同時に加えた適合通知を送付した。この実験群は情報過多による認知負荷の負の影響を検証する目的で設けた。

```{r assignment, file = "R/schedule_data.r", tab.cap = "Assignment Schedule"}
```

実験参加者は2021年9月から2022年2月の間に適合通知を受け取った11,154名の潜在ドナーである。JMDP事務局に無理のない範囲でランダムネスを保つために、我々は実験群を週単位のクラスターランダム化で割り当てた。このとき、可能な限り週と月で実験群がバランスするように設計している。表 \@ref(tab:assignment) に割り当てスケジュールをまとめている。

## Data and Empirical Strategy

```{r experiment-data, include=FALSE}
rawdt <- read_csv(here(data_root, "shaped.csv"), locale = locale(encoding = "cp932"))
use <- dataset(rawdt)
```

我々はJMDPの協力のもと、コーディネーションデータを2022年6月末に受け取った。観測単位は実験参加者である。個人属性として、データは性別・年齢・コーディネーション経験回数・都道府県レベルの在住地区を記録している。コーディネーション過程として、データは各段階（適合通知への返信・確認検査・候補者選定・最終同意・採取）に到達したかどうかを記録している。我々はこれらの変数をアウトカム変数として用いる。特に、適合通知への返信について、データは返信日数と提供意向を追加的に記録している。コーディネーションが中断したならば、データは中断理由を三つのカテゴリ（患者側の理由・健康以外のドナー理由・ドナーの健康理由）で記録している。分析では、日本在住かつコーディネーションが（中断を含めて）終了している11,049名の潜在ドナーを用いる[^exclude]。

```{r ongoing-balance, include=FALSE}
ongoing_f <- lm_robust(
  ongoing ~ treat,
  data = rawdt,
  cluster = if(FALSE) .$RCTweek,
  se_type = "HC1"
) %>%
{
  f <- summary(.)$fstatistic[1]
  numdf <- summary(.)$fstatistic[2]
  dendf <- summary(.)$fstatistic[3]
  p <- pf(f, numdf, dendf, lower.tail = FALSE)

  sprintf("F-test, p-value = $%1.3f$", p)
}
```

[^exclude]: 一人が海外に在住していた。また、データ提供時点でコーディネーションが進行中であった潜在ドナーは104名いた。コーディネーションが進行中の潜在ドナーの比率は実験群間でバランスしている（`r ongoing_f`）。

追加的なデータとして、我々はJMDPがウェブ上で公開している医療機関リストを用いる。このリストは完全な住所・骨髄採取（BM collection）が可能かどうか・末梢血幹細胞採取（PBSC collection）が可能かどうかを含んでいる。我々はこのリストを都道府県レベルで集約し、10平方キロメートルあたりの病院数を計算し、それをコーディネーションデータと都道府県をマージキーにして突合した。我々はこの変数をコーディネーションや提供のトラベルコストとして考慮する。

```{r summary, tab.cap = 'Overview of Field Experiment'}
summary_experiment(use$cs) %>%
  tbl()
```

表 \@ref(tab:summary) はフィールド実験の概要である。パネルAは各実験群の介入を示しており、パネルBは各実験群のサンプルサイズを示している。パネルCはランダム化が成功しているかどうかを検証するバランステストである。多くの変数が実験群間で平均的にバランスしているので、実験群の割り当てはおおよそランダムである。<!-- //TODO 年齢違いを入れるか -->

我々の関心のあるパラメータは母集団全体の平均処置効果であり、実験群間の平均値の差で識別できる。それに加えて、我々は月・週固定効果を取り除き、共変量を加えることで推論の確度を高めるために、線形確率モデルを推定する。$m$月の$w$週に適合通知を受け取った個人$i$についての推定モデルは以下の通りである。

$$
  Y_{imw} =
  \beta_1 \cdot \text{B}_{mw} + \beta_2 \cdot \text{C}_{mw}
  + \beta_3 \cdot \text{D}_{mw}
  + X'_i \gamma + \lambda_m + \theta_w + u_{imw},
$$

ここで$X_i$は個人属性ベクトル、$\lambda_m$と$\theta_w$はそれぞれ月および週のダミー変数である。<!--//TODO クラスター標準誤差を用いるならばその論拠をここに書く --->

# Experimental Results {#result}
## Effects on Reply and Intention {#intention}

初めに、潜在ドナーの意向を最も反映していると考えられる返信への介入効果を推定する。返信のアウトカム変数は提供の意向に関わらず適合通知に返信したならば1を取るダミー変数である。コントロール群（実験群A）の返信率は$88.35$%である。

我々は返信へのメッセージ効果を二つに分解する。第一に、提供意向を伴った返信への効果である。アウトカム変数は潜在ドナーが適合通知に返信し、かつ提供意思を示したならば1を取るダミー変数である。第二に、提供意向を伴わない返信に対する効果である。アウトカム変数は潜在ドナーが適合通知に返信し、かつ提供意思を示していないならば1を取るダミー変数である。ただし、これらの効果を推定するとき、我々は未返信者のアウトカム変数を0とコーディングして、サンプルに含める。二つのアウトカム変数の和は必ず返信のダミー変数となるので、正の意向と負の意向に対する効果の和は返信に対する効果となる。コントロール群では、正の意向を伴う返信率は$55.33$%である一方で、負の意向を伴う返信率は$33.03$%であった。したがって、返信者の$62.63(=55.33/88.35)$%は提供に積極的である。

```{r exogenous-balance, include=FALSE}
exogenous_f <- lm_robust(
  exg_stop_reply ~ treat,
  data = use$cs,
  cluster = if(FALSE) RCTweek,
  se_type = "HC0"
) %>%
{
  f <- summary(.)$fstatistic[1]
  numdf <- summary(.)$fstatistic[2]
  dendf <- summary(.)$fstatistic[3]
  p <- pf(f, numdf, dendf, lower.tail = FALSE)

  sprintf("F-value, p-value = %1.3f", p)
}
```

潜在ドナーが返信する前に、患者側の都合でコーディネーションが中断してしまう可能性がある。これは潜在ドナーの意向と独立に生じるので、我々は各実験群でそのようなケースに該当する$0.5$--$0.7$%を分析サンプルから除外している。ただし、このケースは実験群間でバランスしている（`r exogenous_f`）。

```{r reg-stock, tab.cap = 'Linear Probability Model of Reply and Intention'}
lm_all_stock(use$stock) %>%
  tbl()
```

表 \@ref(tab:reg-stock) は線形確率モデルの推定結果である。奇数列は実験群ダミーだけを説明変数に入れており、単純な平均値の差に対応している。偶数列は実験群ダミーに加えて、個人属性・月および週の固定効果をコントロールしている。推定結果はすべての実験群は、共変量の有無に関わらず、返信や意向に対して統計的に有意な効果を持っていない。我々は代替手法としてロジットモデルを推定（表 \@ref(tab:logit-stock) ）し、同様の結果を得ている（オッズ比の95%信頼区間が1を含んでいる）。

```{r coefplot-reg-stock-subset, fig.cap = 'Effect on Reply and Intentions by Gender and Age Group. Note: These plots show the average effect (and associated 95% confidential interval) on each outcome by gender and age group. We use clustered standard errors with the CR2 adjustment (cluster unit is experimental week). We control number of past coordinations, number of hospitals per 10 square kilometers, number of hospitals with PBSC collection per 10 square kilometers, number of hospitals with BM collection per 10 square kilometers, month dummies, and week dummies.'}

lm_subset_stock(use$stock) %>%
  coefplot()
```

メッセージ効果の異質性を検証するために、我々はサンプルを性別と年齢層（30歳未満か否か）で4つのサブセットに分割し、各サブセットでメッセージ効果を推定する。図 \@ref(fig:coefplot-reg-stock-subset) は係数プロットである。結果として、若い男性グループで、確率メッセージのみを加えた実験群Bが正の意向を伴う返信を約10ポイント（コントロール平均が$38.6$%なので、$25.91$%増加）増やしており、これは統計的に有意である。実験群Bはこのグループにおける提供意向を伴わない返信率を下げているので、全体の返信率に対する効果は6ポイントであり、正の意向を伴う返信に対する効果よりも小さい。<!--//TODO Wild bootstrapを入れるならその議論を追記 -->他の性・年代と比較して、移植成績が良いにも関わらず若い男性の提供意欲は低いことを考慮すれば、確率メッセージはコーディネーションの効率性を改善しているといえる。ただし、他の性・年代グループで、我々の介入は返信や意向に対して統計的に有意な効果をもたない。

## Random Causal Forest {#rcf}

```{r rcf-int, include=FALSE}
rcf <- random_causal_forest(use$cs)
```

介入効果の異質性を深堀りするために、我々は完全にノンパラメトリックに介入効果の異質性を検証できるrandom causal forest (RCF)を用いる[@Athey2016; @Wager2018]。この手法は回帰木アルゴリズムに基づいており、観察可能な特徴で条件づけた平均トリートメント効果を推定する。この手法は労働[@Davis2017]・教育[@Carlana2022]・節電[@Murakami2022]などの広い文脈で用いられている。

このアルゴリズムは研究者によって与えられた共変量の一つ$X_j$を用いて、サンプルを二つのサブサンプル（リーフ）に分割する。具体的に、このアルゴリズムは$X_j \le x$であるサンプルと$X_j > x$であるサンプルに分割する。回帰木はアウトカム変数の平均二乗誤差（誤差はあるリーフに属するサンプルのアウトカムの平均値と観察されるアウトカムの差である）を最小にするように特定の閾値$x$を決める。RCFはあるリーフに属する平均処置効果（条件付き平均処置効果）を推定することが目的なので、予測処置効果の期待平均二乗誤差を最小にするように閾値$x$を決める。この最小化はリーフ間の条件付き平均効果の分散（異質性）を高めかつ、リーフ内の分散を抑えることと同じである。これを終端条件に達するまで各リーフで二つのリーフに分けるプロセスを繰り返す。RCFは終端のリーフにおける条件付き平均処置効果を予測する。

回帰木アルゴリズムの欠点は予測値の分散が大きく（過学習）なり、予測精度が落ちることである。これを防ぐために、RCFはアンサンブル法と呼ばれるアルゴリズムを導入している。これは全データから重複なしのサブサンプルを数千個作り、各サブサンプルで回帰木を育てる。最終的な結果は数千個の回帰木の予測値の平均とする[^tech-detail]。

大雑把に言えば、RCFは観察される個人属性で介入の処置効果を予測する。すなわち、介入を受けていない人についても、その人の属性に基づいて処置効果を予測できる。ただし、この手法は処置の割り当てが潜在成果変数と条件つきにランダムであることを仮定してなければならない。実験群はおおよそランダムに割り当てられているので、我々はこの手法を用いることができる。この小節では、意向を伴う返信への効果に着目する。RCFに用いる共変量は性別・年齢・過去のコーディネーション経験・在住地域の病院の密度である。

[^tech-detail]:技術的な詳細は @Athey2016 ・ @Wager2018 を参照せよ。また、本研究ではRCFを特殊ケースとして扱う一般化ランダムフォレストと呼ばれる手法を用いているが、直観は変わらない。一般化ランダムフォレストの詳細は @Athey2019 ・ @Athey2019a を参照せよ。

```{r boxplot-rcf-int, fig.cap='Boxplot of Predicted Treatment Effects by Gender and Age. Notes: Blue fitted line represents GAM smoothing. Covariates are gender, age, number of past coordinations, number of hospitals per 10 square kilometers, number of hospitals with PBSC collection per 10 square kilometers and number of hospitals with BM collection per 10 square kilometers.'}

boxplot_effect(rcf)
```

```{r include=FALSE}
rcf$pred %>%
  dplyr::filter(male == "Males") %>%
  dplyr::filter(30 < age & age <= 40) %>%
  dplyr::filter(treat == "Message B") %>%
  mutate(high = if_else(effect >= 0.1, 1, 0)) %>%
  group_by(high) %>%
  summarize_at(vars(coordinate:BM_per_area), list(~ mean(.)))

rcf$pred %>%
  dplyr::filter(45 < age) %>%
  dplyr::filter(treat == "Message C") %>%
  mutate(positive = if_else(effect >= 0, 1, 0)) %>%
  group_by(male, positive) %>%
  summarize_at(vars(coordinate:BM_per_area), list(~ mean(.)))

rcf$pred %>%
  group_by(treat) %>%
  summarize_at(vars(effect), list(~var(.)))
```

図\@ref(fig:boxplot-rcf-int)は意向を伴う返信に対する各実験群の予測トリートメント効果の分布を年齢別にプロットしている。注目するべきこととして、25歳以下の男性のすべてに対して、実験群Bの効果は正である。結果として、RCFは30歳以下の男性における実験群Bの平均効果は12.1ポイントであり、図\@ref(fig:reg-stock-subset)で示した線形確率モデルのサブサンプル分析の結果と近い値である（表\@ref(tab:rcf-int-cate)参照）。また、30--40代男性の一部に対して、実験群Bの効果は10ポイント以上とである。そのような男性は相対的に病院の数が多い地域に住んでおり、コーディネーションや提供のトラベリングコストが低いことがわかっている。

Early coordinationメッセージのみを加えた実験群Cの効果は大きく異質的である。30代前半の女性に対して、ほとんどのトリートメント効果は負である。40代後半以上の男女に対して、処置効果の中央値は正であるが広く分布している。驚くべきことに、この年齢層の男女において、実験群Cが正の効果を持つ人は相対的に病院の数が少ない（トラベリングコストが高い）地域に住んでいることがわかっている。

```{r rcf-int-corr, tab.cap='Correlation of Predicted Treatment Effects'}
cf_corr_effect(rcf) %>%
  tbl()
```

実験群Dは確率メッセージ（実験群B）とearly Coordinationメッセージ（実験群C）の両方を加えている。したがって、もし潜在ドナーが実験群Dの情報を完全に理解しているならば、実験群Dの効果は実験群BとCの効果の合計となるはずである。この点を検証するために、表\@ref(tab:rcfint-corr)の列(1)--(4)は実験群Dの処置効果を実験群BとCの効果の合計で回帰している。どの性・年代でも実験群BとCの効果の合計が1ポイント増えると、実験群Dの効果は0.3--0.4ポイント増加する。95%信頼区間は1を含まないので、この増分は1ポイントより統計的に有意に低い。この結果は潜在ドナーが実験群Dの情報を完全に理解しておらず、情報過多による認知負荷になっていること示唆している。

完全に情報を受け取っていない潜在ドナーは確率メッセージもしくはearly coordinationメッセージのどちらかを重視するか、二つの情報を同程度割り引いて評価しているだろう。この点を検証するために、表\@ref(tab:rcfint-corr)の列(4)--(8)は実験群Dの処置効果を実験群Bの効果と実験群Cの効果で回帰している。その結果、若年層の男女では、実験群CとDの偏相関は実験群BとDの偏相関よりも強い。すなわち、彼らは確率メッセージよりもearly coordinationメッセージを重視している。したがって、確率メッセージを提供しているにも関わらず、実験群Dが30歳未満の男性に効果がないのである。

興味深いことに、高齢層の男女では、実験群CとDの偏相関は実験群BとDの偏相関よりも弱い。すなわち、彼らはearly coordinationメッセージよりも確率メッセージを重視している。したがって、40代後半以上の男女における実験群Cの効果の中央値が8ポイント程度であるにも関わらず、実験群Dの処置効果の中央値はほとんどゼロである。

## Response Speed to Notification {#reply-speed}

Early Coordinationメッセージはコーディネーション期間が長くなると、患者の生存確率を下げてしまうという事実を提供している。したがって、このメッセージは適合通知への早期返信を促している可能性がある。この可能性を検証するために、我々は特定の期間以内に返信する確率への効果を線形確率モデルで推定する。アウトカム変数は潜在ドナーが$d$日以内に返信したならば1を取るダミー変数である。$d$日以降に返信した・返信しなかった場合、アウトカム変数は0となる。$d$の値を十分に大きくすれば、この分析は第\@ref(intention)節の結果と一致する。さらに、第\@ref(intention)節と同様に、我々はドナーの意向の視点から二つの効果に分解する。一つは提供意向を伴う$d$日以内の返信への効果である。アウトカムは$d$日以内に返信し、かつ提供の意向を示したならば1を取るダミー変数である。もう一つは提供意向を伴わない$d$日以内の返信への効果である。アウトカムは$d$日以内に返信し、かつ提供の意向を示さなければ1を取るダミー変数である。$d$日以降に返信した・返信しなかった場合、これらのアウトカムも0とコーディングされる。我々は$d = \{4, 7, 10, 14, 21, 28\}$に焦点を当てる。

```{r reply-speed-ctrl, include=FALSE}
ctrl <- with(subset(use$cs, treat == "A" & reply == 1), mean(days_reply))
ctrl_positive <- with(subset(use$cs, treat == "A" & reply == 1 & intention == 1), mean(days_reply))
ctrl_negative <- with(subset(use$cs, treat == "A" & reply == 1 & intention == 0), mean(days_reply))
ctrl_max <- with(subset(use$cs, treat == "A" & reply == 1), max(days_reply))
ctrl_7days <- with(subset(use$flow, treat == "A" & within == 7 & outcome == "Reply"), mean(value))
ctrl_positive_7days <- with(subset(use$flow, treat == "A" & within == 7 & outcome == "Positive intention"), mean(value))
```

コントロール群では、返信者の平均的な返信日数は`r round(ctrl)`日である。また、正もしくは負の意向を伴う返信の平均返信日数はそれぞれ`r round(ctrl_positive)`日・`r round(ctrl_negative)`日である。最長の返信日数は`r ctrl_max`日である。加えて、適合通知に目安として記載されている7日以内の返信は`r round(ctrl_7days*100)`%であり、正の意向を伴う7日以内の返信は`r round(ctrl_positive_7days*100)`%である（未返信者を含む）。

```{r est-subsample-flow, include=FALSE}
est_sub_flow <- lm_subset_flow(use$flow)
```

```{r young-male-flow, fig.cap='Effect on Reply within Specific Days after Sending Notification among Males Less than 30. Notes: These plots show the average effect (and associated 95% confidential interval) on each outcome. We use clustered standard errors with the CR2 adjustment (cluster unit is experimental week). We control number of past coordinations, number of hospitals per 10 square kilometers, number of hospitals with PBSC collection per 10 square kilometers, number of hospitals with BM collection per 10 square kilometers, month dummies, and week dummies.'}

coefplot(est_sub_flow, male == 1 & age_less30 == 1)
```

先の小節で見たように返信や意向への効果は異質的であるので、この小節は性・年代でサブサンプルに分割して、返信日数への効果の異質性に注目する。図\@ref(fig:young-male-flow)は30歳未満の男性の結果である。このサブグループでは、我々は確率メッセージのみを加えた実験群Bが提供意向を伴う全体の返信率を10ポイント程度高めていたことをすでに明らかにしている。図\@ref(fig:young-male-flow)はその効果が14日以内の返信から生じていることを示唆している。実験群Bは提供意向を伴う10日以内の返信を（統計的に有意ではないが）5ポイント程度高めており、14日以内の返信を10ポイント程度高めている。すなわち、実験群Bは提供意向を伴う10日以内の返信を5ポイント、提供意向を伴う10--14日以内の返信を5ポイント高め、これらが全体の返信率を10ポイント高めていることにつながっている。また、このグループでは、早期返信を促している可能性のある実験群C（Early Coordinationメッセージ）が短期間の返信を高めているということはなかった。

```{r young-female-flow, fig.cap='Effect on Reply within Specific Days after Sending Notification among Females Less than 30. Notes: These plots show the average effect (and associated 95% confidential interval) on each outcome. We use clustered standard errors with the CR2 adjustment (cluster unit is experimental week). We control number of past coordinations, number of hospitals per 10 square kilometers, number of hospitals with PBSC collection per 10 square kilometers, number of hospitals with BM collection per 10 square kilometers, month dummies, and week dummies.'}

coefplot(est_sub_flow, male == 0 & age_less30 == 1)
```

しかしながら、実験群Cは30歳未満の女性の早期返信を促している可能性がある。図\@ref(fig:young-male-flow)は30歳未満の女性の結果である。図\@ref(fig:coefplot-reg-stock-subset)より実験群Cは全体の返信率に統計的に有意な影響を与えていない。一方で、この実験群は4日以内の返信率を6ポイント程度高めており、これは5%水準で有意である。

## Effects on the Coordination Process {#process}

```{r est-full-coordination, tab.cap = 'Linear Probability Model of Coordination Process'}
lm_all_coordination(use$coordination) %>%
  tbl()
```

```{r coefplot-reg-subsample-coordination, fig.cap='Effect on Coordination by Gender and Age Group. Note: These plots show the average effect (and associated 95% confidential interval) on each outcome by gender and age group. We use clustered standard errors with the CR2 adjustment (cluster unit is experimental week). We control number of past coordinations, number of hospitals per 10 square kilometers, number of hospitals with PBSC collection per 10 square kilometers, number of hospitals with BM collection per 10 square kilometers, month dummies, and week dummies.'}

lm_subset_coordination(use$coordination) %>%
  coefplot()
```

# Appendix {-}

<!-- //NOTE ロジット推定 -->

```{r logit-stock, tab.cap = 'Logit Model of Reply and Intention'}
logit_all_stock(use$stock, TRUE) %>%
  tbl()
```

```{r logit-coordination, tab.cap = 'Logit Model of Coordination'}
logit_all_coordination(use$coordination, TRUE) %>%
  tbl()
```

<!-- //NOTE Wild bootstrap p-value for robust inference -->

```{r wildbs-young-male-stock, tab.cap = 'Linear Probability Model of Reply and Intentions for Males Less Then 30 Years'}
wildbs_subset_stock(use$stock, male == 1 & age < 30, treat = c("B", "D")) %>%
  tbl()
```

```{r wildbs-young-male-coordination, tab.cap = 'Linear Probability Model of Coordination among Males'}
wildbs_subset_coordination(use$coordination, male == 1 & age < 30, treat = "B") %>%
  tbl()
```

<!-- //NOTE Additional analysis of flow data -->

```{r old-male-flow, fig.cap='Effect on Reply within Specific Days after Sending Notification among Males More than 30. Notes: These plots show the average effect (and associated 95% confidential interval) on each outcome. We use clustered standard errors with the CR2 adjustment (cluster unit is experimental week). We control number of past coordinations, number of hospitals per 10 square kilometers, number of hospitals with PBSC collection per 10 square kilometers, number of hospitals with BM collection per 10 square kilometers, month dummies, and week dummies.'}

coefplot(est_sub_flow, male == 1 & age_less30 == 0)
```

```{r old-female-flow, fig.cap='Effect on Reply within Specific Days after Sending Notification among Females More than 30. Notes: These plots show the average effect (and associated 95% confidential interval) on each outcome. We use clustered standard errors with the CR2 adjustment (cluster unit is experimental week). We control number of past coordinations, number of hospitals per 10 square kilometers, number of hospitals with PBSC collection per 10 square kilometers, number of hospitals with BM collection per 10 square kilometers, month dummies, and week dummies.'}

coefplot(est_sub_flow, male == 0 & age_less30 == 0)
```

<!-- //NOTE RCF -->

```{r rcf-int-cate, tab.cap = 'Conditional Average Treatment Effect Estimated by RCF'}
tbl(rcf$cate)
```